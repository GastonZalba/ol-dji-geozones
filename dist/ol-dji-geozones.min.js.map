{"version":3,"file":"ol-dji-geozones.min.js","sources":["../src/components/i18n/en.ts","../src/components/i18n/es.ts","../src/assets/images/geozone.svg","../src/ol-dji-geozones.ts"],"sourcesContent":["import { i18n } from '../../ol-dji-geozones';\r\n\r\nexport const en: i18n = {\r\n    labels: {\r\n        djiGeoZones: 'Dji Geo Zones',\r\n        level: 'Level',\r\n        type: 'Type',\r\n        startTime: 'Start Time',\r\n        endTime: 'End Time',\r\n        timeTips: 'Time: 24-hour clock',\r\n        maxAltitude: 'Max. Altitude',\r\n        address: 'Address',\r\n        tips: 'Tips',\r\n        link: 'Link',\r\n        learnMore: 'Learn More',\r\n        helperZoom: 'Zoom in to see the Geo Zones',\r\n        expand: 'Expand',\r\n        collapse: 'Collapse',\r\n        hideGeozones: 'Hide Geo Zones',\r\n        showHide: 'Show/Hide Geo Zones'\r\n    },\r\n    levels: [\r\n        {\r\n            id: 0,\r\n            name: 'Warning Zones',\r\n            desc: 'In these Zones, which may not necessarily appear on the DJI GO map, users will be prompted with a warning message. Example Warning Zone: Class E airspace'\r\n        },\r\n        {\r\n            id: 1,\r\n            name: 'Authorization Zones',\r\n            desc: 'In these Zones, which appear blue in the DJI GO map, users will be prompted with a warning and flight is limited by default. Authorization Zones may be unlocked by authorized users using a DJI verified account.'\r\n        },\r\n        {\r\n            id: 2,\r\n            name: 'Restricted Zones',\r\n            desc: 'In these Zones, which appear red the DJI GO app, users will be prompted with a warning and flight is prevented. If you believe you have the authorization to operate in a Restricted Zone, please contact flysafe@dji.com or Online Unlocking.'\r\n        },\r\n        {\r\n            id: 3,\r\n            name: 'Enhanced Warning Zones',\r\n            desc: 'In these Zones, you will be prompted by GEO at the time of flight to unlock the zone using the same steps as in an Authorization Zone, but you do not require a verified account or an internet connection at the time of your flight.'\r\n        },\r\n        {\r\n            id: 4,\r\n            name: 'Regulatory Restricted Zones',\r\n            desc: 'Due to local regulations and policies, flights are prohibited within the scope of some special areas. (Example：Prison)'\r\n        },\r\n        {\r\n            id: 5,\r\n            name: 'Recommended Zones',\r\n            desc: ''\r\n        },\r\n        {\r\n            id: 6,\r\n            name: 'Altitude Zones',\r\n            desc: 'Altitude zones will appear in gray on the map. Users receive warnings in DJI GO, or DJI GO 4 and flight altitude is limited.'\r\n        },\r\n        {\r\n            id: 7,\r\n            name: 'Recommended Zones',\r\n            desc: 'This area is shown in green on the map. It is recommended that you choose these areas for flight arrangements.'\r\n        },\r\n        {\r\n            id: 8,\r\n            name: 'Approved Zones for Light UAVs(China)',\r\n            desc: 'For Approved Zones, pilots of light UAVs flying at an altitude of 120 m or less are not required to obtain permission to fly. Pilots who are planning to fly medium-sized UAVs in Approved Zones at an altitude higher than 120 m, or in GEO Zones other than Approved Zones, must obtain permission via UTMISS before taking off'\r\n        },\r\n        {\r\n            id: 9,\r\n            name: 'Densely Populated Area',\r\n            desc: 'This area is shown in red on the map. Under normal circumstances, the population of this area is more concentrated, so please do not fly over this area. (Example: Commercial Block)'\r\n        }\r\n    ],\r\n    types: [\r\n        {\r\n            id: 0,\r\n            name: 'Airport'\r\n        },\r\n        {\r\n            id: 1,\r\n            name: 'Special Zone'\r\n        },\r\n        {\r\n            id: 2,\r\n            name: 'Military Zone'\r\n        },\r\n        {\r\n            id: 4,\r\n            name: 'Recommended Zones'\r\n        },\r\n        {\r\n            id: 10,\r\n            name: 'Airport'\r\n        },\r\n        {\r\n            id: 13,\r\n            name: 'Recreational airport'\r\n        },\r\n        {\r\n            id: 14,\r\n            name: 'Recreational airport'\r\n        },\r\n        {\r\n            id: 15,\r\n            name: 'Class B Airspace'\r\n        },\r\n        {\r\n            id: 16,\r\n            name: 'Class C Airspace'\r\n        },\r\n        {\r\n            id: 17,\r\n            name: 'Class D Airspace'\r\n        },\r\n        {\r\n            id: 18,\r\n            name: 'Class E Airspace'\r\n        },\r\n        {\r\n            id: 19,\r\n            name: 'Heliport'\r\n        },\r\n        {\r\n            id: 23,\r\n            name: 'Power plant'\r\n        },\r\n        {\r\n            id: 24,\r\n            name: 'Prison'\r\n        },\r\n        {\r\n            id: 26,\r\n            name: 'Stadium'\r\n        },\r\n        {\r\n            id: 27,\r\n            name: 'Prohibited Airspace'\r\n        },\r\n        {\r\n            id: 28,\r\n            name: 'Restricted Airspace'\r\n        },\r\n        {\r\n            id: 29,\r\n            name: 'Temporary Flight Restriction'\r\n        },\r\n        {\r\n            id: 30,\r\n            name: 'Nuclear Power Plant'\r\n        },\r\n        {\r\n            id: 31,\r\n            name: 'Unpaved Airports'\r\n        },\r\n        {\r\n            id: 32,\r\n            name: 'Special Zones'\r\n        },\r\n        {\r\n            id: 33,\r\n            name: 'Military Zones'\r\n        },\r\n        {\r\n            id: 34,\r\n            name: 'Heliport'\r\n        },\r\n        {\r\n            id: 35,\r\n            name: 'Seaplane Base'\r\n        },\r\n        {\r\n            id: 36,\r\n            name: 'Temporary Flight Restriction'\r\n        },\r\n        {\r\n            id: 39,\r\n            name: 'Approved Zones for Light UAVs'\r\n        },\r\n        {\r\n            id: 41,\r\n            name: 'Regulatory Restricted Zones for Light UAVs'\r\n        }\r\n    ]\r\n};\r\n","import { i18n } from '../../ol-dji-geozones';\r\n\r\nexport const es: i18n = {\r\n    labels: {\r\n        djiGeoZones: 'Zonas Geo DJI',\r\n        level: 'Nivel',\r\n        type: 'Tipo',\r\n        startTime: 'Horario de apertura',\r\n        endTime: 'Horario de cierre',\r\n        timeTips: 'Sistema horario: 24 horas',\r\n        maxAltitude: 'Altitud máxima',\r\n        address: 'Dirección',\r\n        tips: 'Consejos',\r\n        link: 'Enlace',\r\n        learnMore: 'Leer más',\r\n        helperZoom: 'Acerque la vista para ver las Zonas Geo',\r\n        expand: 'Expandir',\r\n        collapse: 'Colapsar',\r\n        hideGeozones: 'Ocultar Zonas Geo',\r\n        showHide: 'Mostrar/Ocultar Zonas Geo'\r\n    },\r\n    levels: [\r\n        {\r\n            id: 0,\r\n            name: 'Zonas de advertencia',\r\n            desc: 'En estas Zonas, que pueden no aparecer necesariamente en el mapa DJI GO, los usuarios recibirán un mensaje de advertencia. Ejemplo de zona de advertencia: espacio aéreo de clase E'\r\n        },\r\n        {\r\n            id: 1,\r\n            name: 'Zonas de autorización',\r\n            desc: 'En estas Zonas, que aparecen en azul en el mapa DJI GO, los usuarios recibirán una advertencia y el vuelo está limitado por defecto. Las zonas de autorización pueden ser desbloqueadas por usuarios autorizados mediante una cuenta verificada por DJI.'\r\n        },\r\n        {\r\n            id: 2,\r\n            name: 'Zonas restringidas',\r\n            desc: 'En estas Zonas, que aparecen en rojo en la aplicación DJI GO, los usuarios recibirán una advertencia y se impedirá el vuelo. Si cree que tiene la autorización para operar en una Zona restringida, comuníquese con flysafe@dji.com o Desbloqueo en línea.'\r\n        },\r\n        {\r\n            id: 3,\r\n            name: 'Zonas de advertencia ampliadas',\r\n            desc: 'En estas Zonas, GEO le pedirá en el momento del vuelo que desbloquee la zona siguiendo los mismos pasos que en una Zona de autorización, pero no necesita una cuenta verificada o una conexión a Internet en el momento de su vuelo.'\r\n        },\r\n        {\r\n            id: 4,\r\n            name: 'Zonas reglamentarias restringidas',\r\n            desc: 'Debido a las regulaciones y políticas locales, los vuelos están prohibidos dentro del alcance de algunas áreas especiales. (Ejemplo: prisión)'\r\n        },\r\n        {\r\n            id: 5,\r\n            name: 'Zonas recomendadas',\r\n            desc: ''\r\n        },\r\n        {\r\n            id: 6,\r\n            name: 'Zonas de altiutud',\r\n            desc: 'Las zonas de altitud aparecerán en gris en el mapa. Los usuarios reciben advertencias en DJI GO o DJI GO 4 y la altitud de vuelo es limitada.'\r\n        },\r\n        {\r\n            id: 7,\r\n            name: 'Zonas recomendadas',\r\n            desc: 'Esta área se muestra en verde en el mapa. Se recomienda que elija estas áreas para los arreglos de vuelo.'\r\n        },\r\n        {\r\n            id: 8,\r\n            name: 'Zonas aprobadas para VANTs livianos (China)',\r\n            desc: 'Para las zonas aprobadas, los pilotos de vehículos aéreos no tripulados ligeros que vuelan a una altitud de 120 mo menos no están obligados a obtener permiso para volar. Los pilotos que planean volar UAV de tamaño mediano en Zonas Aprobadas a una altitud superior a 120 m, o en Zonas GEO distintas de las Zonas Aprobadas, deben obtener permiso a través de UTMISS antes de despegar.'\r\n        },\r\n        {\r\n            id: 9,\r\n            name: 'Áreas densamente pobladas',\r\n            desc: 'Esta área se muestra en rojo en el mapa. En circunstancias normales, la población de esta zona está más concentrada, así que no sobrevuele esta zona. (Ejemplo: bloque comercial)'\r\n        }\r\n    ],\r\n    types: [\r\n        {\r\n            id: 0,\r\n            name: 'Aeropuerto'\r\n        },\r\n        {\r\n            id: 1,\r\n            name: 'Zona especial'\r\n        },\r\n        {\r\n            id: 2,\r\n            name: 'Zona Militar'\r\n        },\r\n        {\r\n            id: 4,\r\n            name: 'Zona recomendada'\r\n        },\r\n        {\r\n            id: 10,\r\n            name: 'Aeropuerto'\r\n        },\r\n        {\r\n            id: 13,\r\n            name: 'Aeropuerto recreacional'\r\n        },\r\n        {\r\n            id: 14,\r\n            name: 'Aeropuerto recreacional'\r\n        },\r\n        {\r\n            id: 15,\r\n            name: 'Espacio aéreo clase B'\r\n        },\r\n        {\r\n            id: 16,\r\n            name: 'Espacio aéreo clase C'\r\n        },\r\n        {\r\n            id: 17,\r\n            name: 'Espacio aéreo clase D'\r\n        },\r\n        {\r\n            id: 18,\r\n            name: 'Espacio aéreo clase E'\r\n        },\r\n        {\r\n            id: 19,\r\n            name: 'Helipuerto'\r\n        },\r\n        {\r\n            id: 23,\r\n            name: 'Planta de energía'\r\n        },\r\n        {\r\n            id: 24,\r\n            name: 'Prisión'\r\n        },\r\n        {\r\n            id: 26,\r\n            name: 'Estadio'\r\n        },\r\n        {\r\n            id: 27,\r\n            name: 'Espacio aéreo prohibido'\r\n        },\r\n        {\r\n            id: 28,\r\n            name: 'Espacio aéreo restringido'\r\n        },\r\n        {\r\n            id: 29,\r\n            name: 'Restricción de vuelo temporal'\r\n        },\r\n        {\r\n            id: 30,\r\n            name: 'Planta de energía nuclear'\r\n        },\r\n        {\r\n            id: 31,\r\n            name: 'Aeropuertos sin pavimentar'\r\n        },\r\n        {\r\n            id: 32,\r\n            name: 'Zonas especiales'\r\n        },\r\n        {\r\n            id: 33,\r\n            name: 'Zonas militares'\r\n        },\r\n        {\r\n            id: 34,\r\n            name: 'Helipuerto'\r\n        },\r\n        {\r\n            id: 35,\r\n            name: 'Base de hidroaviones'\r\n        },\r\n        {\r\n            id: 36,\r\n            name: 'Restricción de vuelo temporal'\r\n        },\r\n        {\r\n            id: 39,\r\n            name: 'Zonas aprobadas para VANTs livianos'\r\n        },\r\n        {\r\n            id: 41,\r\n            name: 'Zonas reglamentarias restringidas para VANTs livianos'\r\n        }\r\n    ]\r\n};\r\n","var img = \"data:image/svg+xml,%3csvg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 280.18 280.18'%3e%3cdefs%3e%3cstyle%3e.cls-1%7bfill:%23ffce00%3bfill-opacity:0.68%3bstroke:%23ffce00%3b%7d.cls-1%2c.cls-3%2c.cls-5%2c.cls-6%7bstroke-miterlimit:10%3bstroke-width:0.75px%3b%7d.cls-2%7bfill:%23ff7900%3bfill-opacity:0.46%3b%7d.cls-3%7bfill:%231072d6%3bfill-opacity:0.57%3bstroke:%231072d6%3b%7d.cls-4%7bopacity:0.63%3b%7d.cls-5%7bfill:%23bcbcbc%3bstroke:%23666%3b%7d.cls-6%7bfill:%23fc3424%3bfill-opacity:0.4%3bstroke:%23fc3424%3b%7d%3c/style%3e%3c/defs%3e%3cpath class='cls-1' d='M109.79%2c109.23c-44.68%2c44.68-40.36%2c121.45%2c9.66%2c171.47S246.24%2c335%2c290.92%2c290.36s40.36-121.46-9.65-171.48S154.48%2c64.54%2c109.79%2c109.23ZM270.56%2c270c-34.64%2c34.64-94.15%2c31.29-132.92-7.48s-42.12-98.28-7.48-132.92%2c94.14-31.29%2c132.92%2c7.48S305.2%2c235.36%2c270.56%2c270Z' transform='translate(-59.88 -59.29)'/%3e%3cpath class='cls-2' d='M130.16%2c129.59c-34.64%2c34.64-31.29%2c94.15%2c7.48%2c132.92s98.28%2c42.12%2c132.92%2c7.48%2c31.29-94.14-7.48-132.92S164.79%2c95%2c130.16%2c129.59Zm118%2c118c-24%2c24-64.91%2c22.14-91.29-4.23S128.56%2c176.07%2c152.6%2c152s64.91-22.14%2c91.28%2c4.24S272.15%2c223.51%2c248.12%2c247.55Z' transform='translate(-59.88 -59.29)'/%3e%3cellipse class='cls-3' cx='200.36' cy='199.79' rx='61.55' ry='67.54' transform='translate(-142.47 140.9) rotate(-45)'/%3e%3cg id='Layer_3' data-name='Layer 3'%3e%3cg class='cls-4'%3e%3cpolygon class='cls-5' points='166.25 180 236.66 279.6 236.75 279.51 279.51 236.75 279.6 236.66 180 166.25 166.25 180'/%3e%3cpolygon class='cls-5' points='113.92 100.18 43.51 0.58 43.43 0.67 0.67 43.43 0.58 43.51 100.18 113.92 113.92 100.18'/%3e%3c/g%3e%3cpolygon class='cls-6' points='180 113.92 166.25 100.18 140.09 126.34 113.92 100.18 100.18 113.92 126.34 140.09 100.18 166.25 113.92 180 140.09 153.84 166.25 180 180 166.25 153.84 140.09 180 113.92'/%3e%3c/g%3e%3cg id='Layer_3_copy' data-name='Layer 3 copy'%3e%3cg class='cls-4'%3e%3cpolygon class='cls-5' points='100.18 166.25 0.58 236.66 0.67 236.75 43.43 279.51 43.51 279.6 113.92 180 100.18 166.25'/%3e%3cpolygon class='cls-5' points='180 113.92 279.6 43.51 279.51 43.43 236.75 0.67 236.66 0.58 166.25 100.18 180 113.92'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e\";\n  export default img;","import VectorLayer from 'ol/layer/Vector.js';\r\nimport VectorSource from 'ol/source/Vector.js';\r\nimport Feature, { FeatureLike } from 'ol/Feature.js';\r\nimport Overlay from 'ol/Overlay.js';\r\nimport { transform, transformExtent } from 'ol/proj.js';\r\nimport { getDistance } from 'ol/sphere.js';\r\nimport Polygon from 'ol/geom/Polygon.js';\r\nimport MultiPolygon from 'ol/geom/MultiPolygon.js';\r\nimport Point from 'ol/geom/Point.js';\r\nimport Circle from 'ol/geom/Circle.js';\r\nimport Geometry from 'ol/geom/Geometry.js';\r\nimport BaseEvent from 'ol/events/Event.js';\r\n\r\nimport Style from 'ol/style/Style.js';\r\nimport Fill from 'ol/style/Fill.js';\r\nimport Stroke from 'ol/style/Stroke.js';\r\nimport Icon from 'ol/style/Icon.js';\r\n\r\nimport Control from 'ol/control/Control.js';\r\nimport { asArray, asString } from 'ol/color.js';\r\nimport { fromExtent } from 'ol/geom/Polygon.js';\r\nimport {\r\n    getTopRight,\r\n    getTopLeft,\r\n    getBottomRight,\r\n    getCenter,\r\n    getBottomLeft,\r\n    Extent\r\n} from 'ol/extent.js';\r\nimport MapBrowserEvent from 'ol/MapBrowserEvent.js';\r\nimport Map from 'ol/Map.js';\r\nimport View from 'ol/View.js';\r\nimport { buffer } from 'ol/extent.js';\r\n\r\nimport { Coordinate } from 'ol/coordinate.js';\r\nimport Projection from 'ol/proj/Projection.js';\r\nimport { EventsKey } from 'ol/events.js';\r\nimport { unByKey } from 'ol/Observable.js';\r\n\r\nimport { CombinedOnSignature, EventTypes, OnSignature } from 'ol/Observable.js';\r\nimport { ObjectEvent } from 'ol/Object.js';\r\nimport { Types as ObjectEventTypes } from 'ol/ObjectEventType.js';\r\n\r\n// Import configuration values\r\nimport levelsParams from './assets/_levels-params.json';\r\nimport dronesList from './assets/_drones.json';\r\n\r\nimport * as languages from './components/i18n';\r\n\r\n// Images\r\nimport geozoneSvg from './assets/images/geozone.svg';\r\nimport infoSvg from './assets/images/info.svg';\r\nimport visibilitySvg from './assets/images/visibility.svg';\r\n\r\n// Css\r\nimport './assets/scss/ol-dji-geozones.scss';\r\n\r\n/**\r\n * @protected\r\n */\r\nconst API_AREAS_ENDPOINT = 'https://www-api.dji.com/api/geo/areas';\r\nconst API_INFO_ENDPOINT = 'https://www-api.dji.com/api/geo/point-info';\r\nconst API_LEVELS = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]; // request all the levels, we filter later to avoid some api problems\r\nconst MIN_ZOOM = 9; // < 9 breaks the API\r\n\r\nconst HIDDEN_CLASS = 'ol-dji-geozones--ctrl-toggle-hidden';\r\n\r\nconst DEFAULT_LANGUAGE = 'en';\r\n\r\nconst controlElement = document.createElement('div');\r\n\r\n/**\r\n * OpenLayers Dji Geozones, creates multiples VectorLayers to\r\n * display interactives DJI Geo Zones on the map, requesting the\r\n * data on the fly to an DJI API.\r\n *\r\n * Also, add a Control to select levels of interest and drone to filter the results.\r\n * @fires init\r\n * @fires error\r\n * @constructor\r\n * @extends {ol/control/Control~Control}\r\n * @param opt_options DjiGeozones options, see [DjiGeozones Options](#options) for more details.\r\n */\r\nexport default class DjiGeozones extends Control {\r\n    protected _options: Options;\r\n    protected _i18n: i18n;\r\n\r\n    protected _paramsLevels: Array<LevelParams>;\r\n\r\n    protected _useApiForPopUp: boolean;\r\n\r\n    protected _isVisible: boolean;\r\n    protected _hideGeozones: boolean;\r\n    protected _currentZoom: number;\r\n    protected _lastZoom: number;\r\n    protected _initialized: boolean;\r\n\r\n    protected _listeners: boolean;\r\n    protected _moveendEvtKey: EventsKey | Array<EventsKey>;\r\n    protected _clickEvtKey: EventsKey | Array<EventsKey>;\r\n\r\n    protected _layers: Array<VectorLayer<Feature>>;\r\n    protected _areaDownloaded: MultiPolygon;\r\n\r\n    protected _featuresIdList: Set<string> = new Set();\r\n\r\n    public divControl: HTMLElement;\r\n    public popupContent: HTMLElement;\r\n\r\n    // Ol\r\n    private _map: Map;\r\n    private _view: View;\r\n    private _projection: Projection;\r\n    private _overlay: Overlay;\r\n\r\n    declare on: OnSignature<'change', BaseEvent, EventsKey> &\r\n        OnSignature<'error', ErrorEvent, EventsKey> &\r\n        OnSignature<ObjectEventTypes, ObjectEvent, EventsKey> &\r\n        CombinedOnSignature<ObjectEventTypes | EventTypes, EventsKey>;\r\n\r\n    declare once: OnSignature<'change', BaseEvent, EventsKey> &\r\n        OnSignature<'error', ErrorEvent, EventsKey> &\r\n        OnSignature<ObjectEventTypes, ObjectEvent, EventsKey> &\r\n        CombinedOnSignature<ObjectEventTypes | EventTypes, EventsKey>;\r\n\r\n    declare un: OnSignature<'change', BaseEvent, void> &\r\n        OnSignature<'error', ErrorEvent, EventsKey> &\r\n        OnSignature<ObjectEventTypes, ObjectEvent, void> &\r\n        CombinedOnSignature<ObjectEventTypes | EventTypes, void>;\r\n\r\n    constructor(opt_options?: Options) {\r\n        super({\r\n            target: opt_options.target,\r\n            element: controlElement\r\n        });\r\n\r\n        this._options = {\r\n            urlProxy: '',\r\n            encodeURIRequest: true,\r\n            buffer: 10000, // meters\r\n            drone: 'spark',\r\n            zonesMode: 'total',\r\n            country: 'US',\r\n            showGeozoneIcons: true,\r\n            displayLevels: [2, 6, 1, 0, 3, 4, 7],\r\n            activeLevels: [2, 6, 1, 0, 3, 4, 7],\r\n            createPanel: 'full',\r\n            target: null,\r\n            startCollapsed: false,\r\n            startActive: true,\r\n            dronesToDisplay: dronesList,\r\n            extent: null,\r\n            loadingElement:\r\n                '<div class=\"lds-ellipsis\"><div></div><div></div><div></div><div></div></div>',\r\n            clickEvent: 'singleclick',\r\n            language: DEFAULT_LANGUAGE,\r\n            alert: null,\r\n            // Merge custom options\r\n            ...(opt_options || {})\r\n        };\r\n\r\n        // If language selector is provided and translation exists...\r\n        this._i18n =\r\n            languages[\r\n                this._options.language in languages\r\n                    ? this._options.language\r\n                    : DEFAULT_LANGUAGE\r\n            ];\r\n\r\n        // Merge custom translations\r\n        this._i18n = deepObjectAssign(this._i18n, opt_options.i18n || {});\r\n\r\n        this._paramsLevels = levelsParams;\r\n\r\n        // By default, we use the properties features to show in the popup.\r\n        // The official DJI map, makes an extra request to another API to get the data. I don't understand why.\r\n        // It's more slow and requieres extra requests to an already downloaded data...\r\n        // Either way, this extra API calls are supported if you want.\r\n        this._useApiForPopUp = false;\r\n\r\n        this._hideGeozones = true;\r\n\r\n        this._isVisible = false;\r\n\r\n        this._layers = [];\r\n        this.divControl = null;\r\n        this._areaDownloaded = null;\r\n\r\n        this.on('error', this._onError);\r\n    }\r\n\r\n    /**\r\n     * Remove the control from its current map and attach it to the new map.\r\n     * Pass null to just remove the control from the current map.\r\n     * @param map\r\n     * @public\r\n     */\r\n    setMap(map: Map): void {\r\n        super.setMap(map);\r\n        if (map) {\r\n            if (this._options.createPanel) {\r\n                this._createPanel(\r\n                    this._options.createPanel,\r\n                    this._options.startCollapsed\r\n                );\r\n            }\r\n\r\n            if (this._options.startActive) {\r\n                this.show();\r\n            }\r\n        } else {\r\n            if (super.getMap()) {\r\n                controlElement.remove();\r\n                this.destroy();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Initialize the layers and events.\r\n     * This function is called once only if the control is activated.\r\n     *\r\n     * @fires init\r\n     * @private\r\n     */\r\n    _initialize(): void {\r\n        this._map = super.getMap();\r\n        this._view = this._map.getView();\r\n        this._projection = this._view.getProjection();\r\n\r\n        /**\r\n         * Create and add a Vector Layer for each level\r\n         * @protected\r\n         */\r\n        const createVectorLayers = () => {\r\n            /**\r\n             * Create the style of each layer acoording to the geometry,\r\n             * level, and color obtained from the API\r\n             *\r\n             * @param feature\r\n             * @protected\r\n             */\r\n            const styleFunction = (feature: Feature<Geometry>) => {\r\n                const geom = feature.getGeometry();\r\n                const level = feature.get('level');\r\n                const levelParams = this._getLevelParamsById(level);\r\n                let style: Style;\r\n\r\n                if (geom instanceof Polygon || geom instanceof Circle) {\r\n                    const color = feature.get('color');\r\n\r\n                    style = new Style({\r\n                        fill: new Fill({\r\n                            color: DjiGeozones.colorWithAlpha(color, 0.3)\r\n                        }),\r\n                        stroke: new Stroke({\r\n                            color: color,\r\n                            width: 1\r\n                        }),\r\n                        zIndex: levelParams.zIndex\r\n                    });\r\n                } else if (geom instanceof Point) {\r\n                    style = new Style({\r\n                        image: new Icon({\r\n                            src: levelParams.markerIcon,\r\n                            scale: 0.35,\r\n                            anchor: [0.5, 0.9],\r\n                            crossOrigin: 'anonymous'\r\n                        }),\r\n                        zIndex: levelParams.zIndex * 2\r\n                    });\r\n                }\r\n\r\n                return style;\r\n            };\r\n\r\n            API_LEVELS.forEach((level) => {\r\n                const source = new VectorSource({\r\n                    attributions:\r\n                        '<a href=\"https://www.dji.com/flysafe/geo-map\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">DJI GeoZoneMap</a>'\r\n                });\r\n\r\n                const props = {\r\n                    source,\r\n                    name: 'ol-dji-geozones',\r\n                    level: level,\r\n                    zIndex: this._getLevelParamsById(level).zIndex * 2,\r\n                    visible: this._hideGeozones\r\n                        ? false\r\n                        : this.activeLevels.includes(level)\r\n                        ? true\r\n                        : false,\r\n                    style: styleFunction\r\n                };\r\n\r\n                if (this._options.extent)\r\n                    props['extent'] = this._options.extent;\r\n\r\n                const layer = new VectorLayer(props);\r\n\r\n                source.on('removefeature', ({ feature }) => {\r\n                    const featureId = feature.getId() || feature.get('areaId');\r\n                    this._featuresIdList.delete(String(featureId));\r\n                });\r\n\r\n                this._map.addLayer(layer);\r\n                this._layers.push(layer);\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Create the PopUp element and add it to an Overlay\r\n         * @protected\r\n         */\r\n        const createPopUpOverlay = () => {\r\n            const popupContainer = document.createElement('div');\r\n            popupContainer.id = 'ol-dji-geozones--popup';\r\n            popupContainer.className = `ol-dji-geozones--ol-popup ol-dji-geozones--${this._options.theme}`;\r\n\r\n            this.popupContent = document.createElement('div');\r\n            this.popupContent.id = 'ol-dji-geozones--popup-content';\r\n            this.popupContent.className = 'ol-dji-geozones--ol-popup-content';\r\n\r\n            const popupCloser = document.createElement('a');\r\n            popupCloser.id = 'ol-dji-geozones--popup-closer';\r\n            popupCloser.className = 'ol-dji-geozones--ol-popup-closer';\r\n            popupCloser.href = '#';\r\n            popupCloser.onclick = () => {\r\n                this._overlay.setPosition(undefined);\r\n                popupCloser.blur();\r\n                return false;\r\n            };\r\n\r\n            popupContainer.append(popupCloser);\r\n            popupContainer.append(this.popupContent);\r\n\r\n            this._overlay = new Overlay({\r\n                element: popupContainer,\r\n                autoPan: {\r\n                    animation: {\r\n                        duration: 250\r\n                    }\r\n                }\r\n            });\r\n\r\n            this._map.addOverlay(this._overlay);\r\n        };\r\n\r\n        createVectorLayers();\r\n        createPopUpOverlay();\r\n\r\n        this._initialized = true;\r\n\r\n        super.dispatchEvent('init');\r\n    }\r\n\r\n    /**\r\n     * Create a control panel in the map\r\n     *\r\n     * @param createPanel\r\n     * @param startCollapsed\r\n     * @private\r\n     */\r\n    _createPanel(createPanel: boolean | string, startCollapsed: boolean): void {\r\n        /**\r\n         * Add the 'full' control panel to the viewport map or custom target.\r\n         * This displays each level as a layer, with the possibility to activate or deactivate each one,\r\n         * color legends and a drone switcher.\r\n         *\r\n         * @protected\r\n         */\r\n        const addMapControlFull = () => {\r\n            const createDroneSelector = (): HTMLDivElement => {\r\n                const handleChange = ({ target }) => {\r\n                    this.drone =\r\n                        target.value ||\r\n                        target.options[target.selectedIndex].value;\r\n                    this._getInfoFromView(/* clear = */ true);\r\n                };\r\n\r\n                const droneSelector = document.createElement('div');\r\n                droneSelector.className = 'ol-dji-geozones--drone-selector';\r\n\r\n                const select = document.createElement('select');\r\n                select.onchange = handleChange;\r\n\r\n                if (!this._isVisible)\r\n                    select.setAttribute('disabled', 'disabled');\r\n\r\n                let options = '';\r\n\r\n                this.dronesToDisplay.forEach((drone: Drone) => {\r\n                    const selected = this.drone === drone.id ? 'selected' : '';\r\n                    options += `<option value=\"${drone.id}\" ${selected}>${drone.label}</option>`;\r\n                });\r\n\r\n                select.innerHTML = options;\r\n\r\n                droneSelector.append(select);\r\n\r\n                return droneSelector;\r\n            };\r\n\r\n            const createLevelSelector = (): HTMLDivElement => {\r\n                const handleClick = ({ target }) => {\r\n                    const level = Number(target.value);\r\n\r\n                    if (target.checked) {\r\n                        this.addLevels(level);\r\n                    } else {\r\n                        this.removeLevels(level);\r\n                    }\r\n                };\r\n\r\n                const createLegend = (color: string): HTMLSpanElement => {\r\n                    const span = document.createElement('span');\r\n                    span.className = 'ol-dji-geozones--mark';\r\n                    span.style.border = `1px ${color} solid`;\r\n                    span.style.backgroundColor = DjiGeozones.colorWithAlpha(\r\n                        color,\r\n                        0.4\r\n                    );\r\n                    return span;\r\n                };\r\n\r\n                const createLabel = (\r\n                    label: string,\r\n                    name: string,\r\n                    color: string\r\n                ) => {\r\n                    const labelEl = document.createElement('label');\r\n                    labelEl.htmlFor = name;\r\n                    labelEl.append(createLegend(color));\r\n                    labelEl.append(label);\r\n\r\n                    return labelEl;\r\n                };\r\n\r\n                const createCheckbox = (\r\n                    name: string,\r\n                    value: number,\r\n                    disabled: boolean\r\n                ): HTMLInputElement => {\r\n                    const checkbox = document.createElement('input');\r\n                    checkbox.type = 'checkbox';\r\n                    checkbox.name = name;\r\n                    checkbox.id = name;\r\n                    checkbox.value = String(value);\r\n\r\n                    checkbox.onclick = handleClick;\r\n\r\n                    if (this.activeLevels.indexOf(value) !== -1)\r\n                        checkbox.checked = true;\r\n\r\n                    if (disabled) checkbox.disabled = true;\r\n\r\n                    return checkbox;\r\n                };\r\n\r\n                const createLevelItem = (\r\n                    value: number,\r\n                    { name, desc, color }\r\n                ): HTMLDivElement => {\r\n                    const disabled = !this._isVisible;\r\n                    const id = 'level' + value;\r\n\r\n                    const divContainer = document.createElement('div');\r\n                    divContainer.className = `ol-dji-geozones--item-ctl ol-dji-geozones--item-ctl-${value}`;\r\n                    divContainer.title = desc;\r\n                    // divContainer.setAttribute('style', `--level-color: ${color}`);\r\n                    // divContainer.setAttribute('data-geotooltip', desc);\r\n                    divContainer.setAttribute('data-level', String(value));\r\n                    divContainer.append(createCheckbox(id, value, disabled));\r\n                    divContainer.append(createLabel(name, id, color));\r\n\r\n                    return divContainer;\r\n                };\r\n\r\n                const levelSelector = document.createElement('div');\r\n                levelSelector.className = 'ol-dji-geozones--level-selector';\r\n\r\n                this._options.displayLevels.forEach((lev) => {\r\n                    const level = createLevelItem(lev, this.getLevelById(lev));\r\n                    levelSelector.append(level);\r\n                });\r\n\r\n                return levelSelector;\r\n            };\r\n\r\n            const createButtonCollapser = (): HTMLButtonElement => {\r\n                const button = document.createElement('button');\r\n                button.className =\r\n                    'ol-dji-geozones--collapse ol-dji-geozones--btn-sm';\r\n                button.title = this._i18n.labels.collapse;\r\n                button.onclick = () => this.setPanelCollapsed(true);\r\n                return button;\r\n            };\r\n\r\n            const createButtonVisibility = (): HTMLButtonElement => {\r\n                const button = document.createElement('button');\r\n                button.className =\r\n                    'ol-dji-geozones--visibility ol-dji-geozones--btn-sm';\r\n                button.title = this._i18n.labels.hideGeozones;\r\n                button.innerHTML = `<img src=\"${visibilitySvg}\"/>`;\r\n                button.onclick = () => {\r\n                    this.hide();\r\n                };\r\n                return button;\r\n            };\r\n\r\n            this.divControl.classList.add('ol-dji-geozones--ctrl-full');\r\n\r\n            this.divControl.innerHTML = `\r\n            <header>\r\n                <h3>${this._i18n.labels.djiGeoZones}</h3>\r\n                <span class=\"ol-dji-geozones--loading\">\r\n                    ${this._options.loadingElement}\r\n                </span>\r\n            </header>\r\n            <main>\r\n                <section class=\"ol-dji-geozones--selectors\"></section>\r\n                <section>\r\n                    <div class=\"ol-dji-geozones--logo\" title=\"${this._i18n.labels.expand}\"><img src=\"${geozoneSvg}\"/></div>\r\n                    <span class=\"ol-dji-geozones--advice\">${this._i18n.labels.helperZoom}</span>\r\n                </section>\r\n            </main>\r\n            `;\r\n\r\n            const droneSelector = createDroneSelector();\r\n            this.divControl\r\n                .querySelector('.ol-dji-geozones--selectors')\r\n                .append(droneSelector);\r\n\r\n            const levelSelector = createLevelSelector();\r\n            this.divControl\r\n                .querySelector('.ol-dji-geozones--selectors')\r\n                .append(levelSelector);\r\n\r\n            const buttonCollapse = createButtonCollapser();\r\n            this.divControl.querySelector('header').append(buttonCollapse);\r\n\r\n            const buttonVisibility = createButtonVisibility();\r\n            this.divControl.querySelector('header').append(buttonVisibility);\r\n\r\n            const logo: HTMLDivElement = this.divControl.querySelector(\r\n                '.ol-dji-geozones--logo'\r\n            );\r\n            logo.onclick = () => {\r\n                if (this.divControl.classList.contains(HIDDEN_CLASS)) {\r\n                    this.show();\r\n                }\r\n                this.setPanelCollapsed(false);\r\n            };\r\n        };\r\n\r\n        /**\r\n         * Add the 'compact' control panel to the viewport map or custom target.\r\n         * This is a simple Toggler to activate/deactivate the Geozones\r\n         *\r\n         * @param targetPanel If provided, the panel wil be rendered outside the viewport\r\n         * @protected\r\n         */\r\n        const addMapControlCompact = () => {\r\n            this.divControl.classList.add('ol-dji-geozones--ctrl-compact');\r\n\r\n            this.divControl.innerHTML = `\r\n            <header>\r\n                <span class=\"ol-dji-geozones--loading\">\r\n                    ${this._options.loadingElement}\r\n                </span>\r\n            </header>\r\n            <main>\r\n                <section>\r\n                    <div class=\"ol-dji-geozones--logo\" title=\"${this._i18n.labels.showHide}\"><img src=\"${geozoneSvg}\"/></div>\r\n                </section>\r\n            </main>\r\n            `;\r\n\r\n            const logo: HTMLDivElement = this.divControl.querySelector(\r\n                '.ol-dji-geozones--logo'\r\n            );\r\n\r\n            logo.onclick = () => {\r\n                const hiddenClass = 'ol-dji-geozones--ctrl-toggle-hidden';\r\n                if (this.divControl.classList.contains(hiddenClass)) {\r\n                    this.show();\r\n                } else {\r\n                    this.hide();\r\n                }\r\n            };\r\n        };\r\n\r\n        this.divControl = controlElement;\r\n\r\n        this.divControl.className = `ol-dji-geozones ol-control ol-dji-geozones--${this._options.theme}`;\r\n\r\n        if (this._hideGeozones) {\r\n            this.divControl.classList.add(\r\n                'ol-dji-geozones--ctrl-toggle-hidden'\r\n            );\r\n        } else {\r\n            if (!this._isVisible) {\r\n                this.divControl.classList.add('ol-dji-geozones--ctrl-disabled');\r\n            }\r\n        }\r\n\r\n        if (startCollapsed) {\r\n            this.divControl.classList.add('ol-dji-geozones--ctrl-collapsed');\r\n        }\r\n\r\n        if (createPanel === true || createPanel === 'full') {\r\n            addMapControlFull();\r\n        } else if (createPanel === 'compact') {\r\n            addMapControlCompact();\r\n        } else {\r\n            return;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _setLayersVisible(bool: boolean): void {\r\n        this.layers.forEach((layer) => {\r\n            if (!bool) {\r\n                layer.setVisible(bool);\r\n            } else if (bool && this.activeLevels.includes(layer.get('level'))) {\r\n                layer.setVisible(bool);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Enable or disable the inputs and the select in the control\r\n     * @private\r\n     */\r\n    _setControlEnabled(enabled: boolean): void {\r\n        if (!this.divControl) return;\r\n\r\n        const changeState = (\r\n            array: NodeListOf<HTMLInputElement | HTMLSelectElement>\r\n        ) => {\r\n            array.forEach((el) => {\r\n                if (enabled) {\r\n                    el.removeAttribute('disabled');\r\n                } else {\r\n                    el.disabled = true;\r\n                }\r\n            });\r\n        };\r\n\r\n        if (enabled) {\r\n            this.divControl.classList.remove('ol-dji-geozones--ctrl-disabled');\r\n        } else {\r\n            this.divControl.classList.add('ol-dji-geozones--ctrl-disabled');\r\n        }\r\n\r\n        const inputs: NodeListOf<HTMLInputElement> =\r\n            this.divControl.querySelectorAll('input');\r\n        changeState(inputs);\r\n\r\n        const selects: NodeListOf<HTMLSelectElement> =\r\n            this.divControl.querySelectorAll('select');\r\n        changeState(selects);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param evt\r\n     * @param type\r\n     * @protected\r\n     */\r\n    async _getPointInfoFromClick(\r\n        evt: MapBrowserEvent<UIEvent>,\r\n        type: 'useApiForPopUp' | 'useFeaturesForPopUp'\r\n    ): Promise<void> {\r\n        const infoKeys = [\r\n            'name',\r\n            'level',\r\n            'type',\r\n            'height',\r\n            'shape',\r\n            'start_at',\r\n            'end_at',\r\n            'url',\r\n            'address',\r\n            'description'\r\n        ];\r\n        let idInfoRequest = 0;\r\n\r\n        const getInfoFromApiLatLng = async (\r\n            coordinate: Coordinate\r\n        ): Promise<Array<{ [key: string]: unknown }> | boolean> => {\r\n            // Prevent multiples requests\r\n            idInfoRequest += 1;\r\n            const request = idInfoRequest;\r\n\r\n            return new Promise((resolve) => {\r\n                setTimeout(async () => {\r\n                    if (request !== idInfoRequest) return;\r\n\r\n                    const center4326 = transform(\r\n                        coordinate,\r\n                        this._projection,\r\n                        'EPSG:4326'\r\n                    );\r\n\r\n                    const clickLatLng = {\r\n                        lat: center4326[1],\r\n                        lng: center4326[0]\r\n                    };\r\n\r\n                    const apiJson = await this._getApiGeoData(\r\n                        'info',\r\n                        clickLatLng\r\n                    );\r\n\r\n                    const areas = apiJson.areas;\r\n\r\n                    if (!areas.length) resolve(false);\r\n\r\n                    const featuresProps = [];\r\n\r\n                    for (const area of areas) {\r\n                        featuresProps.push(area);\r\n                    }\r\n\r\n                    resolve(featuresProps);\r\n                }, 100);\r\n            });\r\n        };\r\n\r\n        /**\r\n         *\r\n         * @param features\r\n         * @protected\r\n         */\r\n        const getInfoFromFeatures = (\r\n            features: Array<FeatureLike>\r\n        ): Array<{ [key: string]: unknown }> => {\r\n            const featuresProps = [];\r\n\r\n            features.forEach((feature) => {\r\n                const props = {};\r\n\r\n                infoKeys.forEach((key) => (props[key] = feature.get(key)));\r\n\r\n                featuresProps.push(props);\r\n            });\r\n\r\n            return featuresProps;\r\n        };\r\n\r\n        const showGeozoneDataInPopUp = (\r\n            geozonesData: Array<DjiApiResponseArea>,\r\n            coordinates: Coordinate\r\n        ) => {\r\n            const createTooltip = (level) => {\r\n                const getPos = (el: HTMLElement) => {\r\n                    return el.getBoundingClientRect();\r\n                };\r\n\r\n                let evtKey: EventsKey | EventsKey[];\r\n\r\n                const showPopUp = () => {\r\n                    infoTooltip.style.position = 'fixed';\r\n\r\n                    const position = getPos(iconTooltip);\r\n                    infoTooltip.style.top = position.top + 'px';\r\n                    infoTooltip.style.left = position.left + 'px';\r\n                    infoTooltip.classList.add(\r\n                        'ol-dji-geozones--active-tooltip'\r\n                    );\r\n                    evtKey = this._map.once('movestart', () => closePopUp());\r\n                    document.body.append(infoTooltip);\r\n                };\r\n\r\n                const closePopUp = () => {\r\n                    infoTooltip.classList.remove(\r\n                        'ol-dji-geozones--active-tooltip'\r\n                    );\r\n                    unByKey(evtKey);\r\n                    container.append(infoTooltip);\r\n                };\r\n\r\n                const infoTooltip = document.createElement('span');\r\n                infoTooltip.className = `ol-dji-geozones--info ol-dji-geozones--${this._options.theme}`;\r\n                infoTooltip.innerHTML = `<span class=\"ol-dji-geozones--info-text\">${level.desc}</span><span class=\"ol-dji-geozones--info-back\"></span>`;\r\n                infoTooltip.setAttribute(\r\n                    'style',\r\n                    `--level-color: ${level.color}`\r\n                );\r\n\r\n                const iconTooltip = document.createElement('span');\r\n                iconTooltip.className = 'ol-dji-geozones--icon';\r\n                iconTooltip.innerHTML = `<img src=\"${infoSvg}\">`;\r\n\r\n                iconTooltip.onmouseover = () => showPopUp();\r\n                iconTooltip.onclick = () => showPopUp();\r\n                iconTooltip.onmouseout = () => closePopUp();\r\n\r\n                const container = document.createElement('div');\r\n                container.className = 'ol-dji-geozones--tooltip';\r\n                container.append(iconTooltip);\r\n                container.append(infoTooltip);\r\n                return container;\r\n            };\r\n\r\n            const parseDataToHtml = (\r\n                responseApiArea: DjiApiResponseArea\r\n            ): HTMLDivElement => {\r\n                const {\r\n                    name,\r\n                    level,\r\n                    type,\r\n                    height,\r\n                    description,\r\n                    begin_at,\r\n                    end_at,\r\n                    address,\r\n                    url\r\n                } = responseApiArea;\r\n\r\n                const levelValues = this.getLevelById(level);\r\n                const lbl = this._i18n.labels;\r\n\r\n                const typeName = this._getGeozoneTypeById(type)?.name;\r\n\r\n                const html = `\r\n                    <div class=\"ol-dji-geozones--marker\">\r\n                        <img src=\"${levelValues.markerCircle}\">\r\n                    </div>\r\n                    <div class=\"ol-dji-geozones--main\">\r\n                        <h3 class=\"ol-dji-geozones--title\">${name}</h3>\r\n                        <p class=\"ol-dji-geozones--level\">${lbl.level}: ${\r\n                            levelValues.name\r\n                        } </p>\r\n                    ${\r\n                        typeName\r\n                            ? `<p class=\"ol-dji-geozones--type\">\r\n                        ${lbl.type}: ${typeName}\r\n                    </p>`\r\n                            : ''\r\n                    }                     \r\n                        ${\r\n                            begin_at\r\n                                ? `<p class=\"ol-dji-geozones--start_time\">${lbl.startTime}: ${begin_at}</p>`\r\n                                : ''\r\n                        }\r\n                        ${\r\n                            end_at\r\n                                ? `<p class=\"ol-dji-geozones--end_time\">${lbl.endTime}: ${end_at}</p><p class=\"ol-dji-geozones--time_tips\">${lbl.timeTips}</p>`\r\n                                : ''\r\n                        }         \r\n                        ${\r\n                            height\r\n                                ? `<p class=\"ol-dji-geozones--height\">${lbl.maxAltitude} (m): ${height}</p>`\r\n                                : ''\r\n                        } \r\n                        ${\r\n                            address\r\n                                ? `<p class=\"ol-dji-geozones--address\">${lbl.address}: ${address}</p>`\r\n                                : ''\r\n                        }\r\n                        ${\r\n                            description\r\n                                ? `<p class=\"ol-dji-geozones--desc\">${lbl.tips}: ${description}</p>`\r\n                                : ''\r\n                        }\r\n                        ${\r\n                            url\r\n                                ? `<p class=\"ol-dji-geozones--url\">${lbl.link}: <a href=\"${url}\">${lbl.learnMore}</a></p>`\r\n                                : ''\r\n                        }\r\n                </div>`;\r\n\r\n                const item = document.createElement('div');\r\n                item.className = 'ol-dji-geozones--item';\r\n                item.innerHTML = html;\r\n\r\n                item.querySelector('.ol-dji-geozones--level').append(\r\n                    createTooltip(levelValues)\r\n                );\r\n\r\n                return item;\r\n            };\r\n\r\n            const preventDuplicates = [];\r\n\r\n            const arrGeozonesData = Array.isArray(geozonesData)\r\n                ? geozonesData\r\n                : [geozonesData];\r\n\r\n            this.popupContent.innerHTML = '';\r\n\r\n            arrGeozonesData.forEach((geozoneProps) => {\r\n                const element = parseDataToHtml(geozoneProps);\r\n                // The oficial DJI map show duplicates, but we don't want that\r\n                if (preventDuplicates.indexOf(element.innerHTML) === -1) {\r\n                    preventDuplicates.push(element.innerHTML);\r\n                    this.popupContent.append(element);\r\n                    this.popupContent.append(document.createElement('HR'));\r\n                }\r\n            });\r\n\r\n            this._overlay.setPosition(coordinates);\r\n        };\r\n\r\n        try {\r\n            if (!this._isVisible) {\r\n                this._overlay.setPosition(undefined);\r\n                return;\r\n            }\r\n\r\n            const opt_options = {\r\n                layerFilter: (layer: VectorLayer<Feature>) =>\r\n                    layer.get('name') === 'ol-dji-geozones'\r\n            };\r\n\r\n            let data;\r\n\r\n            // Call the API  to download the information\r\n            if (type === 'useApiForPopUp') {\r\n                if (this._map.hasFeatureAtPixel(evt.pixel, opt_options)) {\r\n                    this.popupContent.innerHTML =\r\n                        this._options.loadingElement.toString();\r\n                    this._overlay.setPosition(evt.coordinate);\r\n\r\n                    data = await getInfoFromApiLatLng(evt.coordinate);\r\n                }\r\n\r\n                // Use the previously downloaded features information\r\n            } else {\r\n                const features = this._map.getFeaturesAtPixel(\r\n                    evt.pixel,\r\n                    opt_options\r\n                );\r\n\r\n                if (features && features.length) {\r\n                    data = getInfoFromFeatures(features);\r\n                }\r\n            }\r\n\r\n            if (data && data.length)\r\n                showGeozoneDataInPopUp(data, evt.coordinate);\r\n            else this._overlay.setPosition(undefined);\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param clear\r\n     * @protected\r\n     */\r\n    _getInfoFromView(clear = false): void {\r\n        let idAreasRequest = 0;\r\n\r\n        /**\r\n         * The level parameter returned by the API is sometimes wrong (2 != 6),\r\n         * so wee need to fixed using the color.\r\n         * Last checked: 2023-04-16\r\n         * @param feature\r\n         * @protected\r\n         */\r\n        const fixLevelValue = (feature: Feature<Geometry>) => {\r\n            const color = feature.get('color');\r\n            const level = Object.keys(this._paramsLevels).find(\r\n                (key) => this._paramsLevels[key].color === color\r\n            );\r\n            feature.set('level', level, /* silent */ true);\r\n            return feature;\r\n        };\r\n\r\n        /**\r\n         * Parse the json response of the API an create Open Layers features.\r\n         * @param djiJson\r\n         * @protected\r\n         */\r\n        const apiResponseToFeatures = (djiJson): false | Feature[] => {\r\n            const areas = djiJson.areas;\r\n\r\n            if (!areas || !areas.length) return false;\r\n\r\n            const features: Feature[] = [];\r\n\r\n            for (const area of areas) {\r\n                // If the feature already exists, continue\r\n                if (this._featuresIdList.has(String(area.area_id))) {\r\n                    continue;\r\n                }\r\n\r\n                const featureProps = {\r\n                    address: area.address,\r\n                    begin_at: area.begin_at,\r\n                    color: area.color,\r\n                    city: area.city,\r\n                    country: area.country,\r\n                    data_source: area.data_source,\r\n                    description: area.description,\r\n                    end_at: area.end_at,\r\n                    height: area.height,\r\n                    level: area.level,\r\n                    name: area.name,\r\n                    radius: area.radius,\r\n                    shape: area.shape,\r\n                    type: area.type,\r\n                    url: area.url,\r\n                    lng: area.lng,\r\n                    lat: area.lat\r\n                };\r\n\r\n                // Only a few of \"areas\" come with polygons\r\n                if (area.polygon_points) {\r\n                    const featureExtra = new Feature({\r\n                        ...featureProps,\r\n                        geometry: new Polygon(area.polygon_points).transform(\r\n                            'EPSG:4326',\r\n                            this._projection\r\n                        )\r\n                    });\r\n\r\n                    featureExtra.setId(area.area_id + '_poly');\r\n                    features.push(fixLevelValue(featureExtra));\r\n                }\r\n\r\n                this._featuresIdList.add(String(area.area_id));\r\n\r\n                if (this._options.showGeozoneIcons) {\r\n                    const feature = new Feature({\r\n                        ...featureProps,\r\n                        geometry: new Point([area.lng, area.lat]).transform(\r\n                            'EPSG:4326',\r\n                            this._projection\r\n                        )\r\n                    });\r\n\r\n                    // Store the id to avoid duplicates\r\n                    feature.setId(area.area_id);\r\n                    features.push(fixLevelValue(feature));\r\n                }\r\n\r\n                if (area.sub_areas) {\r\n                    area.sub_areas.forEach((sub_area) => {\r\n                        let subFeature;\r\n\r\n                        if (sub_area.polygon_points) {\r\n                            subFeature = new Feature({\r\n                                color: sub_area.color,\r\n                                height: sub_area.height,\r\n                                level: sub_area.level,\r\n                                name: area.name,\r\n                                radius: sub_area.radius,\r\n                                shape: sub_area.shape,\r\n                                type: area.type,\r\n                                lng: sub_area.lng,\r\n                                lat: sub_area.lat,\r\n                                geometry: new Polygon(\r\n                                    sub_area.polygon_points\r\n                                ).transform('EPSG:4326', this._projection)\r\n                            });\r\n                        } else {\r\n                            subFeature = new Feature({\r\n                                color: sub_area.color,\r\n                                height: sub_area.height,\r\n                                level: sub_area.level,\r\n                                name: area.name,\r\n                                radius: sub_area.radius,\r\n                                shape: sub_area.shape,\r\n                                type: area.type,\r\n                                lng: sub_area.lng,\r\n                                lat: sub_area.lat,\r\n                                geometry: new Circle(\r\n                                    [sub_area.lng, sub_area.lat],\r\n                                    sub_area.radius / 100000\r\n                                ).transform('EPSG:4326', this._projection)\r\n                            });\r\n                        }\r\n\r\n                        subFeature.set('areaId', area.area_id);\r\n                        features.push(fixLevelValue(subFeature));\r\n                    });\r\n                }\r\n            }\r\n\r\n            return features;\r\n        };\r\n\r\n        /**\r\n         *\r\n         * @param features\r\n         * @protected\r\n         */\r\n        const addFeaturesToEachLevel = (features: Feature[]) => {\r\n            if (!features) return;\r\n\r\n            features.forEach((feature) => {\r\n                const level = feature.get('level');\r\n                const layer = this.getLayerByLevel(level);\r\n                layer.getSource().addFeature(feature);\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Clear all the elements in the Dji Geozones layers\r\n         * @protected\r\n         */\r\n        const clearFeatures = (): void => {\r\n            this.layers.forEach((layer) => {\r\n                layer.getSource().clear();\r\n            });\r\n        };\r\n\r\n        // Prevent multiples requests\r\n        idAreasRequest += 1;\r\n        const request = idAreasRequest;\r\n\r\n        // Original DJI map same behavior to prevent multiples requests\r\n        setTimeout(async () => {\r\n            if (request !== idAreasRequest) return;\r\n\r\n            try {\r\n                this._showLoading(true);\r\n\r\n                const center = this._view.getCenter();\r\n                const center4326 = transform(\r\n                    center,\r\n                    this._projection,\r\n                    'EPSG:4326'\r\n                );\r\n\r\n                const viewLatLng = {\r\n                    lat: center4326[1],\r\n                    lng: center4326[0]\r\n                };\r\n\r\n                if (clear) {\r\n                    this._areaDownloaded = null; // Remove area already downloaded\r\n                }\r\n\r\n                const data = await this._getApiGeoData('areas', viewLatLng);\r\n\r\n                if (data) {\r\n                    if (clear) clearFeatures();\r\n\r\n                    const features = apiResponseToFeatures(data);\r\n\r\n                    if (features) addFeaturesToEachLevel(features);\r\n\r\n                    // console.log(data);\r\n                }\r\n            } catch (err) {\r\n                this.dispatchEvent(new ErrorEvent(err));\r\n            }\r\n\r\n            this._showLoading(false);\r\n        }, 300);\r\n    }\r\n\r\n    _onError = (err: ErrorEvent) => {\r\n        this.hide();\r\n        if (err.message) console.error(err);\r\n    };\r\n\r\n    /**\r\n     * Controller for the API rquests.\r\n     * @param typeApiRequest\r\n     * @param latLng\r\n     * @protected\r\n     */\r\n    async _getApiGeoData(\r\n        typeApiRequest: 'areas' | 'info',\r\n        latLng: { lat: number; lng: number }\r\n    ): Promise<DjiApiResponse> {\r\n        const apiRequest = async (\r\n            typeApiRequest: 'areas' | 'info',\r\n            { lng, lat },\r\n            searchRadius: number\r\n        ) => {\r\n            const api_endpoint =\r\n                typeApiRequest === 'areas'\r\n                    ? API_AREAS_ENDPOINT\r\n                    : API_INFO_ENDPOINT;\r\n\r\n            // If not proxy is passed, make a direct request\r\n            // Maybe in the future the api will has updated CORS restrictions\r\n            let url = api_endpoint + '?';\r\n\r\n            const queryObj: ApiReqArguments = {\r\n                drone: this.drone,\r\n                zones_mode: this.zonesMode,\r\n                country: this.country,\r\n                level: API_LEVELS,\r\n                lng: lng,\r\n                lat: lat,\r\n                search_radius: searchRadius\r\n            };\r\n\r\n            Object.keys(queryObj).forEach(\r\n                (key) => (url += `${key}=${queryObj[key]}&`)\r\n            );\r\n\r\n            const urlRequest =\r\n                this._options.encodeURIRequest === false\r\n                    ? url\r\n                    : encodeURIComponent(url);\r\n\r\n            const finalUrl = this._options.urlProxy\r\n                ? this._options.urlProxy + urlRequest\r\n                : urlRequest;\r\n\r\n            const response = await fetch(finalUrl);\r\n\r\n            if (!response.ok) throw new Error('HTTP-Error: ' + response.status);\r\n\r\n            return await response.json();\r\n        };\r\n\r\n        const getPointInfo = async (\r\n            latLng: { lat: number; lng: number },\r\n            searchRadius: number\r\n        ) => {\r\n            const data = await apiRequest('info', latLng, searchRadius);\r\n            return data;\r\n        };\r\n\r\n        const getAreas = async (\r\n            centerLatLng: { lat: number; lng: number },\r\n            searchRadius: number\r\n        ) => {\r\n            let extent = this._view.calculateExtent();\r\n\r\n            if (this._options.buffer) {\r\n                // Convert the extent to meters\r\n                extent = transform(extent, this._projection, 'EPSG:3857');\r\n\r\n                // Apply buffer in meters\r\n                extent = this._options.buffer\r\n                    ? buffer(extent, this._options.buffer)\r\n                    : extent;\r\n\r\n                // Restore extent in map projection\r\n                extent = transform(extent, 'EPSG:3857', this._projection);\r\n            }\r\n\r\n            const polygon = fromExtent(extent);\r\n\r\n            if (this._areaDownloaded) {\r\n                if (\r\n                    this._areaDownloaded.intersectsCoordinate(\r\n                        getCenter(extent)\r\n                    ) &&\r\n                    this._areaDownloaded.intersectsCoordinate(\r\n                        getBottomLeft(extent)\r\n                    ) &&\r\n                    this._areaDownloaded.intersectsCoordinate(\r\n                        getTopRight(extent)\r\n                    ) &&\r\n                    this._areaDownloaded.intersectsCoordinate(\r\n                        getBottomRight(extent)\r\n                    ) &&\r\n                    this._areaDownloaded.intersectsCoordinate(\r\n                        getTopLeft(extent)\r\n                    )\r\n                ) {\r\n                    // whe already have the data, do nothing\r\n                    return;\r\n                }\r\n\r\n                this._areaDownloaded.appendPolygon(polygon);\r\n            } else {\r\n                this._areaDownloaded = new MultiPolygon([\r\n                    polygon.getCoordinates()\r\n                ]);\r\n            }\r\n\r\n            const data = await apiRequest('areas', centerLatLng, searchRadius);\r\n\r\n            return data;\r\n        };\r\n\r\n        const getMapRadius = ({ lng, lat }): number => {\r\n            const center = [lng, lat];\r\n            const size = this._map.getSize();\r\n            let extent = this._view.calculateExtent(size);\r\n            extent = transformExtent(extent, this._projection, 'EPSG:4326');\r\n            const posSW = [extent[0], extent[1]];\r\n            const centerToSW =\r\n                getDistance(center, posSW) + this._options.buffer;\r\n            return parseInt(String(centerToSW));\r\n        };\r\n\r\n        if (!this._isVisible) return;\r\n\r\n        const searchRadius = getMapRadius(latLng);\r\n        let data;\r\n\r\n        if (typeApiRequest === 'areas') {\r\n            data = await getAreas(latLng, searchRadius);\r\n        } else {\r\n            data = await getPointInfo(latLng, searchRadius);\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * Show/hide the loading in the control\r\n     * @param {Boolean} bool\r\n     * @protected\r\n     */\r\n    _showLoading(bool: boolean): void {\r\n        if (!this.divControl) return;\r\n\r\n        if (bool) this.divControl.classList.add('ol-dji-geozones--isLoading');\r\n        else this.divControl.classList.remove('ol-dji-geozones--isLoading');\r\n    }\r\n\r\n    /**\r\n     * Show or hides the control panel\r\n     * @param visible\r\n     * @public\r\n     */\r\n    setPanelVisible(visible: boolean): void {\r\n        if (!this.divControl) {\r\n            return;\r\n        }\r\n        if (visible) {\r\n            this.divControl.classList.remove('ol-dji-geozones--ctrl-hidden');\r\n        } else {\r\n            this.divControl.classList.add('ol-dji-geozones--ctrl-hidden');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Collapse/expand the control panel\r\n     * @param collapsed\r\n     * @public\r\n     */\r\n    setPanelCollapsed(collapsed: boolean): void {\r\n        if (!this.divControl) {\r\n            return;\r\n        }\r\n        if (collapsed) {\r\n            this.divControl.classList.add('ol-dji-geozones--ctrl-collapsed');\r\n        } else {\r\n            this.divControl.classList.remove('ol-dji-geozones--ctrl-collapsed');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get all the layers\r\n     * @public\r\n     */\r\n    get layers(): Array<VectorLayer<Feature>> {\r\n        return this._layers;\r\n    }\r\n\r\n    /**\r\n     * Get the layer acordding the level\r\n     * @param level\r\n     * @public\r\n     */\r\n    getLayerByLevel(level: number): VectorLayer<Feature> {\r\n        let find: VectorLayer<Feature>;\r\n        for (const layer of this.layers) {\r\n            if (\r\n                layer.get('level') != undefined &&\r\n                layer.get('level') == level\r\n            ) {\r\n                find = layer;\r\n                break;\r\n            }\r\n        }\r\n        return find;\r\n    }\r\n\r\n    /**\r\n     * Get the geozone type (airport, heliport, etc) by id\r\n     * @param id\r\n     * @protected\r\n     */\r\n    _getGeozoneTypeById(id: number = null): i18n['types'][0] {\r\n        return this._i18n.types.find((el) => el.id == id);\r\n    }\r\n\r\n    /**\r\n     * Getter for the list with all the supported Drones\r\n     * @protected\r\n     */\r\n    get dronesToDisplay(): Array<Drone> {\r\n        return this._options.dronesToDisplay;\r\n    }\r\n\r\n    /**\r\n     * Setter for API parameter `drone`. Triggers an API request\r\n     * @param drone\r\n     */\r\n    set drone(drone: string) {\r\n        this._options.drone = drone;\r\n        this._getInfoFromView();\r\n    }\r\n    /**\r\n     * Getter for Api parameter drone\r\n     * @public\r\n     */\r\n    get drone(): string {\r\n        return this._options.drone;\r\n    }\r\n    /**\r\n     * Setter for API parameter `zonesMode`. Triggers an API request\r\n     * @param zonesMode\r\n     * @public\r\n     */\r\n    set zonesMode(zonesMode: string) {\r\n        this._options.zonesMode = zonesMode;\r\n        this._getInfoFromView();\r\n    }\r\n\r\n    /**\r\n     * Getter for API parameter `zonesMode`\r\n     * @public\r\n     */\r\n    get zonesMode(): string {\r\n        return this._options.zonesMode;\r\n    }\r\n\r\n    /**\r\n     * Setter for API parameter `country`. Triggers an API request\r\n     * @param country\r\n     * @public\r\n     */\r\n    set country(country: string) {\r\n        this._options.country = country;\r\n        this._getInfoFromView();\r\n    }\r\n\r\n    /**\r\n     * Getter for API parameter `country`\r\n     * @public\r\n     */\r\n    get country(): string {\r\n        return this._options.country;\r\n    }\r\n\r\n    /**\r\n     * Get the level parameters, like color, icon, and description\r\n     * @param id\r\n     * @protected\r\n     */\r\n    _getLevelParamsById(id: number = null): LevelParams {\r\n        return this._paramsLevels.find((lev: LevelParams) => lev.id == id);\r\n    }\r\n\r\n    /**\r\n     * Get all the parameters from a level and the i18n texts\r\n     * @param id\r\n     * @public\r\n     */\r\n    getLevelById(id: number = null): Level {\r\n        const params = this._paramsLevels.find(\r\n            (lev: LevelParams) => lev.id == id\r\n        );\r\n        const texts: i18n['levels'][0] = this._i18n.levels.find(\r\n            (lev) => lev.id == id\r\n        );\r\n        return { ...params, ...texts };\r\n    }\r\n\r\n    /**\r\n     * Replace the active levels with this values and refresh the view\r\n     * @param levels\r\n     * @public\r\n     */\r\n    set activeLevels(levels: Array<number>) {\r\n        this._options.activeLevels = levels;\r\n        this._options.displayLevels.forEach((lev) => {\r\n            const layer = this.getLayerByLevel(lev);\r\n            if (levels.includes(lev)) {\r\n                layer.setVisible(true);\r\n            } else {\r\n                layer.setVisible(false);\r\n            }\r\n        });\r\n    }\r\n\r\n    get activeLevels(): Array<number> {\r\n        return this._options.activeLevels;\r\n    }\r\n\r\n    /**\r\n     * Add the level/s to the view\r\n     * @param levels\r\n     * @param refresh If true, refresh the view and show the active levels\r\n     * @public\r\n     */\r\n    addLevels(levels: Array<number> | number, refresh = true): void {\r\n        const arrLevels = !Array.isArray(levels) ? [levels] : levels;\r\n        this.activeLevels = [...this.activeLevels, ...arrLevels];\r\n\r\n        if (refresh) {\r\n            arrLevels.forEach((lev) => {\r\n                const layer = this.getLayerByLevel(lev);\r\n                layer.setVisible(true);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove the level/s from the view\r\n     *\r\n     * @param levels\r\n     * @param refresh If true, refresh the view and show the actived levels\r\n     * @public\r\n     */\r\n    removeLevels(levels: Array<number> | number, refresh = true): void {\r\n        const arrLevels = !Array.isArray(levels) ? [levels] : levels;\r\n        this.activeLevels = this.activeLevels.filter(\r\n            (x) => !arrLevels.includes(x)\r\n        );\r\n\r\n        if (refresh) {\r\n            arrLevels.forEach((lev) => {\r\n                const layer = this.getLayerByLevel(lev);\r\n                layer.setVisible(false);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes the control, layers, overlays and events from the map\r\n     * @public\r\n     */\r\n    destroy(): void {\r\n        this.layers.forEach((layer) => {\r\n            this._map.removeLayer(layer);\r\n        });\r\n\r\n        this._map.removeOverlay(this._overlay);\r\n\r\n        this._removeListeners();\r\n    }\r\n\r\n    /**\r\n     * Hide the geoZones and the Control\r\n     * @public\r\n     */\r\n    hide(): void {\r\n        this._hideGeozones = true;\r\n        this._setLayersVisible(false);\r\n        this._setControlEnabled(false);\r\n\r\n        this._removeListeners();\r\n\r\n        if (this.divControl) {\r\n            this.divControl.classList.add(HIDDEN_CLASS);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Show the geoZones and the Control\r\n     * @public\r\n     */\r\n    show(): void {\r\n        if (!this._initialized) {\r\n            this._initialize();\r\n        }\r\n\r\n        if (!this._listeners) {\r\n            this._addListeners();\r\n        }\r\n\r\n        this._hideGeozones = false;\r\n        this._isVisible = this._view.getZoom() >= MIN_ZOOM;\r\n\r\n        this._showLoading(true);\r\n\r\n        if (this._isVisible) {\r\n            this._setControlEnabled(true);\r\n            this._getInfoFromView();\r\n            this._setLayersVisible(true);\r\n\r\n            if (this.divControl) {\r\n                this.divControl.classList.remove(HIDDEN_CLASS);\r\n            }\r\n        } else {\r\n            this._alert(this._i18n.labels.helperZoom);\r\n            this._showLoading(false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _removeListeners() {\r\n        unByKey(this._clickEvtKey);\r\n        unByKey(this._moveendEvtKey);\r\n        this._listeners = false;\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _addListeners(): void {\r\n        const handleZoomEnd = (): void => {\r\n            if (this._currentZoom < MIN_ZOOM) {\r\n                // Hide the layer and disable the control\r\n                if (this._isVisible) {\r\n                    this._setLayersVisible(false);\r\n                    this._isVisible = false;\r\n                    this._setControlEnabled(false);\r\n                }\r\n            } else {\r\n                // Show the layers and enable the control\r\n                if (!this._isVisible) {\r\n                    this._setLayersVisible(true);\r\n                    this._isVisible = true;\r\n                    this._setControlEnabled(true);\r\n\r\n                    if (this.divControl) {\r\n                        this.divControl.classList.remove(HIDDEN_CLASS);\r\n                    }\r\n                } else {\r\n                    // If the view is closer, don't do anything, we already had the features\r\n                    if (!this._lastZoom || this._currentZoom > this._lastZoom)\r\n                        return;\r\n                }\r\n\r\n                this._getInfoFromView();\r\n            }\r\n        };\r\n\r\n        const handleDragEnd = (): void => {\r\n            if (!this._isVisible || this._hideGeozones) return;\r\n            this._getInfoFromView();\r\n        };\r\n\r\n        this._moveendEvtKey = this._map.on('moveend', (): void => {\r\n            this._currentZoom = this._view.getZoom();\r\n\r\n            if (this._currentZoom !== this._lastZoom) handleZoomEnd();\r\n            else handleDragEnd();\r\n\r\n            this._lastZoom = this._currentZoom;\r\n        });\r\n\r\n        this._clickEvtKey = this._map.on(\r\n            this._options.clickEvent,\r\n            (evt: MapBrowserEvent<UIEvent>): void => {\r\n                const type = this._useApiForPopUp\r\n                    ? 'useApiForPopUp'\r\n                    : 'useFeaturesForPopUp';\r\n\r\n                this._getPointInfoFromClick(evt, type);\r\n            }\r\n        );\r\n\r\n        this._listeners = true;\r\n    }\r\n\r\n    /**\r\n     * Function to display messages to the user\r\n     *\r\n     * @param msg\r\n     * @private\r\n     */\r\n    _alert(msg: string): void {\r\n        if (typeof this._options.alert === 'function') {\r\n            this._options.alert(msg);\r\n        } else {\r\n            // Default and ugly alert message\r\n            alert(msg);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  **_[static]_** - Generate an RGBA color from an hexadecimal\r\n     *\r\n     * Adapted from https://stackoverflow.com/questions/28004153\r\n     * @param color Hexadeciaml color\r\n     * @param alpha Opacity\r\n     * @protected\r\n     */\r\n    static colorWithAlpha(color: string, alpha = 1): string {\r\n        const [r, g, b] = Array.from(asArray(color));\r\n        return asString([r, g, b, alpha]);\r\n    }\r\n}\r\n\r\n/**\r\n * Custom Event to pass error in the dispatchEvent\r\n */\r\nclass ErrorEvent extends BaseEvent {\r\n    message: Error['message'];\r\n    stack: Error['stack'];\r\n\r\n    constructor(error: Error) {\r\n        super('error');\r\n        this.message = error.message;\r\n        this.stack = error.stack;\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @param target\r\n * @param sources\r\n * @returns\r\n */\r\nconst deepObjectAssign = (target, ...sources) => {\r\n    sources.forEach((source) => {\r\n        Object.keys(source).forEach((key) => {\r\n            const s_val = source[key];\r\n            const t_val = target[key];\r\n            target[key] =\r\n                t_val &&\r\n                s_val &&\r\n                typeof t_val === 'object' &&\r\n                typeof s_val === 'object' &&\r\n                !Array.isArray(t_val) // Don't merge arrays\r\n                    ? deepObjectAssign(t_val, s_val)\r\n                    : s_val;\r\n        });\r\n    });\r\n    return target;\r\n};\r\n/**\r\n * **_[interface]_** - Dji Api Response\r\n * @protected\r\n */\r\ninterface DjiApiResponseArea {\r\n    name: string;\r\n    level: number;\r\n    type: number;\r\n    height: number;\r\n    description: string;\r\n    begin_at: string;\r\n    end_at: string;\r\n    address: string;\r\n    url: string;\r\n    [key: string]: unknown;\r\n    color: string;\r\n}\r\n/**\r\n * **_[interface]_** - Dji Api Response\r\n * @protected\r\n */\r\ninterface DjiApiResponse {\r\n    areas: Array<DjiApiResponseArea>;\r\n}\r\n/**\r\n * **_[interface]_** - Dji Api Parameters for requests\r\n *\r\n */\r\ninterface ApiReqArguments {\r\n    /**\r\n     * - `0` - Warning Zones\r\n     * - `1` - Authorization Zones\r\n     * - `2` - Restricted Zones\r\n     * - `3` - Enhanced Warning Zones\r\n     * - `4` - Regulatory Restricted Zones\r\n     * - `5` - Recommended Zones (2) **Apparently this level is only valid for Japan**\r\n     * - `6` - Altitude Zones\r\n     * - `7` - Recommended Zones\r\n     * - `8` - Approved Zones for Light UAVs(China) **Only valid for China**\r\n     * - `9` - Densely Populated Area **NOT SUPPORTED - This level exists in the oficial Geo Zone Map, but this data is not provided by the api. On the other hand, now days this level is apparently valid only for Japan and China**\r\n     */\r\n    level: number[];\r\n\r\n    /**\r\n     * - `dji-mavic-3` (Mavic 3)\r\n     * - `dji-mini-se` (Mavic Mini SE)\r\n     * - `dji-air-2s` (Air 2s)\r\n     * - `dji-fpv` (FPV)\r\n     * - `mavic-mini-2` (Mavic Mini 2)\r\n     * - `mavic-mini` (Mavic Mini)\r\n     * - `mavic-2-enterprise` (Mavic 2 Enterprise)\r\n     * - `mavic-2` (Mavic 2)\r\n     * - `mavic-air` (Mavic Air)\r\n     * - `mavic-air-2` (Mavic Air 2)\r\n     * - `mavic-pro` (Mavic Pro)\r\n     * - `spark` (Spark)\r\n     * - `phantom-4-pro` (Phantom 4 Pro)\r\n     * - `phantom-4-advanced` (Phantom 4 Advanced)\r\n     * - `phantom-4` (Phantom 4)\r\n     * - `phantom-4-rtk` (Phantom 4 RTK)\r\n     * - `phantom-4-multispectral` (Phantom 4 Multispectral)\r\n     * - `phantom-3-pro` (Phantom 3 Pro\r\n     * - `phantom-3-advanced` (Phantom 3 Advanced)\r\n     * - `phantom-3-standard` (Phantom 3 Standard)\r\n     * - `phantom-3-4K` (Phantom 3 4K)\r\n     * - `phantom-3-se` (Phantom 3 SE)\r\n     * - `inspire-2` (Inspire 2)\r\n     * - `inspire-1-series` (Inspire 1 Series)\r\n     * - `m200-series` (M200 Series)\r\n     * - `m300-series` (M300 Series)\r\n     * - `m600-series` (M600 Series)\r\n     * - `m100` (M100)\r\n     * - `mg1p` (MG 1S/1A/1P/1P RTK/T10/T16/T20/T30)\r\n     * - `dji-mini-2` (DJI Mini 2)\r\n     */\r\n    drone: string;\r\n\r\n    /**\r\n     * Apparently doesn't affects the response of the api\r\n     * - `US`\r\n     * - `AR`\r\n     * - _etc_ ([See the supported list](https://www.dji.com/flysafe/geo-map))\r\n     */\r\n    country: string;\r\n\r\n    /**\r\n     * Apparently only accepts 'total'\r\n     */\r\n    zones_mode: string;\r\n\r\n    /**\r\n     * Map View center point Longitude\r\n     */\r\n    lng: number;\r\n\r\n    /**\r\n     * Map View center point Latitude\r\n     */\r\n    lat: number;\r\n\r\n    /**\r\n     * Radius of the current view of the map\r\n     */\r\n    search_radius: number;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Drone\r\n * @protected\r\n */\r\nexport interface Drone {\r\n    id: string;\r\n    label: string;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - DjiGeozones levels parameters specified when creating a DjiGeozones\r\n * Provide the colors, icons and more from each level.\r\n * @protected\r\n */\r\ninterface LevelParams {\r\n    id: number;\r\n    color: string;\r\n    zIndex: number;\r\n    markerIcon: string;\r\n    markerCircle: string;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - DjiGeozones levels translations specified when creating a DjiGeozones\r\n * @protected\r\n */\r\ninterface LevelLang {\r\n    id: number;\r\n    name: string;\r\n    desc: string;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - DjiGeozones levels parameters and trasnlations specified when creating a DjiGeozones\r\n * @protected\r\n */\r\ninterface Level extends LevelParams, LevelLang {}\r\n\r\n/**\r\n * **_[interface]_** - Custom Language specified when creating a DjiGeozones\r\n */\r\nexport interface i18n {\r\n    labels: {\r\n        djiGeoZones: string;\r\n        level: string;\r\n        type: string;\r\n        startTime: string;\r\n        endTime: string;\r\n        timeTips: string;\r\n        maxAltitude: string;\r\n        address: string;\r\n        tips: string;\r\n        link: string;\r\n        learnMore: string;\r\n        helperZoom: string;\r\n        expand: string;\r\n        collapse: string;\r\n        hideGeozones: string;\r\n        showHide: string;\r\n    };\r\n    levels: LevelLang[];\r\n    types: {\r\n        id: number;\r\n        name: string;\r\n    }[];\r\n}\r\n\r\n/**\r\n * **_[interface]_** - DjiGeozones Options specified when creating a DjiGeozones instance\r\n *\r\n * Default values:\r\n * ```javascript\r\n * {\r\n *   urlProxy: '',\r\n *   encodeURIRequest: true,\r\n *   buffer: 10000, // meters\r\n *   drone: 'spark', // See parameter in the DJI API section\r\n *   zonesMode: 'total', // See parameter in the DJI API section\r\n *   country: 'US', // See parameter in the DJI API section\r\n *   showGeozoneIcons: true, // Display geozones icons\r\n *   displayLevels: [2, 6, 1, 0, 3, 4, 7],\r\n *   activeLevels: [2, 6, 1, 0, 3, 4, 7],\r\n *   createPanel: 'full',\r\n *   targetPanel: null,\r\n *   startCollapsed: true,\r\n *   startActive: true,\r\n *   dronesToDisplay: null,\r\n *   extent: null,\r\n *   loadingElement: '<div class=\"lds-ellipsis\"><div></div><div></div><div></div><div></div></div>',\r\n *   clickEvent: 'singleclick',\r\n *   theme: 'light',\r\n *   language: 'en',\r\n *   i18n: {...} // Translations according to selected language\r\n *   alert: alert // Default browser alert function\r\n * }\r\n * ```\r\n */\r\nexport interface Options {\r\n    /**\r\n     * Url/endpoint from a Reverse Proxy to avoid CORS restrictions\r\n     */\r\n    urlProxy?: string;\r\n    /**\r\n     * To encode or not the outgoing request (depending on proxy)\r\n     */\r\n    encodeURIRequest?: boolean;\r\n    /**\r\n     * Current map radius is increased by the provided value (in meters) and used to request the areas.\r\n     * Very useful for the highest zoom levels, to allow geozones near by being displayed.\r\n     * A value of 0 will only search geozones (the centroid of these) that are inside the current view extent.\r\n     */\r\n    buffer?: number;\r\n    /*\r\n     * Drone id to be used as default in the API request\r\n     */\r\n    drone?: string;\r\n    /**\r\n     * zonesMode to be used in the API request\r\n     */\r\n    zonesMode?: string;\r\n    /**\r\n     * Country identifier to be used in the API request\r\n     */\r\n    country?: string;\r\n    /**\r\n     * Display geozones icons\r\n     */\r\n    showGeozoneIcons?: boolean;\r\n    /**\r\n     * Geozone Levels to be shown in the control panel\r\n     */\r\n    displayLevels?: Array<number>;\r\n    /**\r\n     * Geozone Levels to be actived by default in the Control and API request\r\n     */\r\n    activeLevels?: Array<number>;\r\n    /**\r\n     * Use a custom drone list to show in the select. If not provided, we use all the available drones\r\n     * The models are extracted from https://flysafe-api.dji.com/dji/drones\r\n     * See [drone](#drone-2) for the complete list.\r\n     */\r\n    dronesToDisplay?: Array<Drone>;\r\n    /**\r\n     * The bounding extent for layer rendering.\r\n     * The layers will not be rendered outside of this extent.\r\n     */\r\n    extent?: Extent;\r\n    /**\r\n     * Create or not a control panel on the map\r\n     * - 'full' displays each level as a layer, with the possibility to activate or deactivate each one,\r\n     * color legends and a drone switcher.\r\n     * - 'compact' it's a simple toggler button to enable/disable the geoZones.\r\n     * - use false to disable the panel\r\n     */\r\n    createPanel?: boolean | 'full' | 'compact';\r\n    /**\r\n     * Specify a target if you want the control to be rendered outside of the map's viewport.\r\n     */\r\n    target?: HTMLElement | string;\r\n    /**\r\n     * Whether panel is minimized when created.\r\n     */\r\n    startCollapsed?: boolean;\r\n    /**\r\n     * Show GeoZones on initialize\r\n     */\r\n    startActive?: boolean;\r\n    /**\r\n     * Loading element to be shown in the Controller when loading API data\r\n     */\r\n    loadingElement?: string;\r\n    /**\r\n     * Type of Click event to activate the PopUp\r\n     */\r\n    clickEvent?: 'singleclick' | 'dblclick';\r\n    /**\r\n     * Color theme of the Control Panel\r\n     */\r\n    theme?: 'light' | 'dark';\r\n    /**\r\n     * Language to be used in the Controller panel and PopUp. This doesn't affects the API requests.\r\n     * If i18n is set, this will be ignored.\r\n     */\r\n    language?: 'en' | 'es';\r\n    /**\r\n     * Add custom translations\r\n     */\r\n    i18n?: i18n;\r\n    /**\r\n     * Custom alert function to display messages\r\n     */\r\n    alert?(msg: string): void;\r\n}\r\n"],"names":["labels","djiGeoZones","level","type","startTime","endTime","timeTips","maxAltitude","address","tips","link","learnMore","helperZoom","expand","collapse","hideGeozones","showHide","levels","id","name","desc","types","img","API_LEVELS","HIDDEN_CLASS","controlElement","document","createElement","DjiGeozones","Control","constructor","opt_options","super","target","element","this","_featuresIdList","Set","_onError","err","hide","message","console","error","_options","Object","assign","urlProxy","encodeURIRequest","buffer","drone","zonesMode","country","showGeozoneIcons","displayLevels","activeLevels","createPanel","startCollapsed","startActive","dronesToDisplay","dronesList","extent","loadingElement","clickEvent","language","alert","_i18n","languages","deepObjectAssign","i18n","_paramsLevels","levelsParams","_useApiForPopUp","_hideGeozones","_isVisible","_layers","divControl","_areaDownloaded","on","setMap","map","_createPanel","show","getMap","remove","destroy","_initialize","_map","_view","getView","_projection","getProjection","styleFunction","feature","geom","getGeometry","get","levelParams","_getLevelParamsById","style","Polygon","Circle","color","Style","fill","Fill","colorWithAlpha","stroke","Stroke","width","zIndex","Point","image","Icon","src","markerIcon","scale","anchor","crossOrigin","forEach","source","VectorSource","attributions","props","visible","includes","layer","VectorLayer","featureId","getId","delete","String","addLayer","push","createVectorLayers","popupContainer","className","theme","popupContent","popupCloser","href","onclick","_overlay","setPosition","undefined","blur","append","Overlay","autoPan","animation","duration","addOverlay","createPopUpOverlay","_initialized","dispatchEvent","addMapControlFull","classList","add","innerHTML","geozoneSvg","droneSelector","select","onchange","value","options","selectedIndex","_getInfoFromView","setAttribute","selected","label","createDroneSelector","querySelector","levelSelector","handleClick","Number","checked","addLevels","removeLevels","createLabel","labelEl","htmlFor","span","border","backgroundColor","createLegend","createCheckbox","disabled","checkbox","indexOf","createLevelItem","divContainer","title","lev","getLevelById","createLevelSelector","buttonCollapse","button","setPanelCollapsed","createButtonCollapser","buttonVisibility","createButtonVisibility","contains","addMapControlCompact","_setLayersVisible","bool","layers","setVisible","_setControlEnabled","enabled","changeState","array","el","removeAttribute","querySelectorAll","_getPointInfoFromClick","evt","infoKeys","idInfoRequest","getInfoFromApiLatLng","async","coordinate","request","Promise","resolve","setTimeout","center4326","transform","clickLatLng","lat","lng","areas","_getApiGeoData","length","featuresProps","area","showGeozoneDataInPopUp","geozonesData","coordinates","createTooltip","evtKey","showPopUp","infoTooltip","position","iconTooltip","getBoundingClientRect","top","left","once","closePopUp","body","unByKey","container","onmouseover","onmouseout","parseDataToHtml","responseApiArea","height","description","begin_at","end_at","url","levelValues","lbl","typeName","_a","_getGeozoneTypeById","html","markerCircle","item","preventDuplicates","arrGeozonesData","Array","isArray","geozoneProps","layerFilter","data","hasFeatureAtPixel","pixel","toString","features","getFeaturesAtPixel","key","getInfoFromFeatures","log","clear","idAreasRequest","fixLevelValue","keys","find","set","apiResponseToFeatures","djiJson","has","area_id","featureProps","city","data_source","radius","shape","polygon_points","featureExtra","Feature","geometry","setId","sub_areas","sub_area","subFeature","addFeaturesToEachLevel","getLayerByLevel","getSource","addFeature","clearFeatures","_showLoading","center","getCenter","viewLatLng","ErrorEvent","typeApiRequest","latLng","apiRequest","searchRadius","queryObj","zones_mode","search_radius","urlRequest","encodeURIComponent","finalUrl","response","fetch","ok","Error","status","json","getAreas","centerLatLng","calculateExtent","polygon","fromExtent","intersectsCoordinate","getBottomLeft","getTopRight","getBottomRight","getTopLeft","appendPolygon","MultiPolygon","getCoordinates","size","getSize","transformExtent","posSW","centerToSW","getDistance","parseInt","getMapRadius","getPointInfo","setPanelVisible","collapsed","params","texts","refresh","arrLevels","filter","x","removeLayer","removeOverlay","_removeListeners","_listeners","_addListeners","getZoom","_alert","_clickEvtKey","_moveendEvtKey","handleZoomEnd","_currentZoom","_lastZoom","handleDragEnd","msg","alpha","r","g","b","from","asArray","asString","BaseEvent","stack","sources","s_val","t_val"],"mappings":"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"}
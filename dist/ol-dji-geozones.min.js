/*!
 * ol-dji-geozones - v2.2.4
 * https://github.com/GastonZalba/ol-dji-geozones#readme
 * Built: Fri Jan 12 2024 12:59:41 GMT-0300 (hora estándar de Argentina)
*/
!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s(require("ol/layer/Vector.js"),require("ol/source/Vector.js"),require("ol/Feature.js"),require("ol/Overlay.js"),require("ol/proj.js"),require("ol/sphere.js"),require("ol/geom/Polygon.js"),require("ol/geom/MultiPolygon.js"),require("ol/geom/Point.js"),require("ol/geom/Circle.js"),require("ol/events/Event.js"),require("ol/style/Style.js"),require("ol/style/Fill.js"),require("ol/style/Stroke.js"),require("ol/style/Icon.js"),require("ol/control/Control.js"),require("ol/color.js"),require("ol/extent.js"),require("ol/Observable.js")):"function"==typeof define&&define.amd?define(["ol/layer/Vector.js","ol/source/Vector.js","ol/Feature.js","ol/Overlay.js","ol/proj.js","ol/sphere.js","ol/geom/Polygon.js","ol/geom/MultiPolygon.js","ol/geom/Point.js","ol/geom/Circle.js","ol/events/Event.js","ol/style/Style.js","ol/style/Fill.js","ol/style/Stroke.js","ol/style/Icon.js","ol/control/Control.js","ol/color.js","ol/extent.js","ol/Observable.js"],s):(e="undefined"!=typeof globalThis?globalThis:e||self).DjiGeozones=s(e.ol.layer.Vector,e.ol.source.Vector,e.ol.Feature,e.ol.Overlay,e.ol.proj,e.ol.sphere,e.ol.geom.Polygon,e.ol.geom.MultiPolygon,e.ol.geom.Point,e.ol.geom.Circle,e.ol.events.Event,e.ol.style.Style,e.ol.style.Fill,e.ol.style.Stroke,e.ol.style.Icon,e.ol.control.Control,e.ol.color,e.ol.extent,e.ol.Observable)}(this,(function(e,s,o,t,i,a,n,l,r,d,c,p,h,m,u,g,v,f,y){"use strict";var b=[{id:0,color:"#FFCC00",zIndex:11,markerIcon:"https://www1.djicdn.com/dps/6734f5340f66c7be37db48c8889392bf.png",markerCircle:"https://www2.djicdn.com/assets/images/flysafe/geo-system/warning-98a8a2c8d6768e22957488ce962d77c3.png?from=cdnMap"},{id:1,color:"#1088F2",zIndex:13,markerIcon:"https://www1.djicdn.com/dps/fbbea9e33581907cac182adb4bcd0c94.png",markerCircle:"https://www4.djicdn.com/assets/images/flysafe/geo-system/authorization-878e879982c9555bcaab7bb6bce3c6ca.png?from=cdnMap"},{id:2,color:"#DE4329",zIndex:15,markerIcon:"https://www1.djicdn.com/dps/d47dfe9f089f259631fbed99610b8b5a.png",markerCircle:"https://www5.djicdn.com/assets/images/flysafe/geo-system/restricted-e0ce1467a8df2d07ec6a33cf11f4279e.png?from=cdnMap"},{id:3,color:"#EE8815",zIndex:12,markerIcon:"https://www1.djicdn.com/dps/df822149e1e6e9e804e177813e044238.png",markerCircle:"https://www4.djicdn.com/assets/images/flysafe/geo-system/enhanced_warning-623fea05bff2f83f3c0ff5a65a41a1df.png?from=cdnMap"},{id:4,color:"#37C4DB",zIndex:11,markerIcon:"https://www1.djicdn.com/dps/53b33783709b6ed06bc3afdd21ac2a81.png",markerCircle:"https://www4.djicdn.com/assets/images/flysafe/geo-system/recommended-e92f991d039ae145c9b1c72ad62b26b2.png?from=cdnMap"},{id:5,color:"#00BE00",zIndex:11,markerIcon:"https://www1.djicdn.com/dps/53b33783709b6ed06bc3afdd21ac2a81.png",markerCircle:"https://www4.djicdn.com/assets/images/flysafe/geo-system/recommended-e92f991d039ae145c9b1c72ad62b26b2.png?from=cdnMap"},{id:6,color:"#979797",zIndex:10,markerIcon:"https://www1.djicdn.com/dps/f5961991d664e130fcf9ad01b1f28043.png",markerCircle:"https://www1.djicdn.com/assets/images/flysafe/geo-system/Oval-34907c1071d63a3f1fffdc739b0943d9.png?from=cdnMap"},{id:7,color:"#00BE00",zIndex:11,markerIcon:"https://www1.djicdn.com/dps/9d922ae5fbd80d3166a844a9e249ceb3.png",markerCircle:"https://www1.djicdn.com/assets/images/flysafe/geo-system/regulations-2dfeef5b11017811dcaa720c86c49406.png?from=cdnMap"},{id:8,color:"#00BE00",zIndex:11,markerIcon:"https://www1.djicdn.com/dps/53b33783709b6ed06bc3afdd21ac2a81.png",markerCircle:"https://www1.djicdn.com/dps/a968914208241c3f6a5a3c64c221b8ff.png"},{id:9,color:"#DE4329",zIndex:15,markerIcon:"https://www1.djicdn.com/dps/d47dfe9f089f259631fbed99610b8b5a.png",markerCircle:"https://www5.djicdn.com/assets/images/flysafe/geo-system/restricted-e0ce1467a8df2d07ec6a33cf11f4279e.png?from=cdnMap"}],_=[{id:"dji-flycart-30",label:"DJI FlyCart 30"},{id:"dji-air-3",label:"DJI Air 3"},{id:"m350-rtk",label:"M350 RTK"},{id:"dji-mavic-3-pro",label:"DJI Mavic 3 Pro"},{id:"inspire-3",label:"Inspire 3"},{id:"dji-mini-3",label:"DJI Mini 3"},{id:"dji-mavic-3-classic",label:"DJI Mini 3 Classic"},{id:"industry-260",label:"Mavic 3E/3T"},{id:"dji-avata",label:"Avata"},{id:"dji-mini-3-pro",label:"Mini 3 Pro"},{id:"dji-mavic-3",label:"Mavic 3"},{id:"dji-mini-se",label:"Mavic Mini SE"},{id:"dji-air-2s",label:"Air 2s"},{id:"dji-fpv",label:"FPV"},{id:"mavic-mini-2",label:"Mavic Mini 2"},{id:"mavic-mini",label:"Mavic Mini"},{id:"mavic-2-enterprise",label:"Mavic 2 Enterprise"},{id:"mavic-2",label:"Mavic 2"},{id:"mavic-air",label:"Mavic Air"},{id:"mavic-air-2",label:"Mavic Air 2"},{id:"mavic-pro",label:"Mavic Pro"},{id:"spark",label:"Spark"},{id:"phantom-4-pro",label:"Phantom 4 Pro"},{id:"phantom-4-advanced",label:"Phantom 4 Advanced"},{id:"phantom-4",label:"Phantom 4"},{id:"phantom-4-rtk",label:"Phantom 4 RTK"},{id:"phantom-4-multispectral",label:"Phantom 4 Multispectral"},{id:"phantom-3-pro",label:"Phantom 3 Pro"},{id:"phantom-3-advanced",label:"Phantom 3 Advanced"},{id:"phantom-3-standard",label:"Phantom 3 Standard"},{id:"phantom-3-4K",label:"Phantom 3 4K"},{id:"phantom-3-se",label:"Phantom 3 SE"},{id:"inspire-2",label:"Inspire 2"},{id:"inspire-1-series",label:"Inspire 1 Series"},{id:"m200-series",label:"M200 Series"},{id:"m300-series",label:"M300 Series"},{id:"m600-series",label:"M600 Series"},{id:"m100",label:"M100"},{id:"mg1p",label:"MG 1S/1A/1P/1P RTK/T10/T16/T20/T30"},{id:"dji-mini-2",label:"DJI Mini 2"}];var j=Object.freeze({__proto__:null,en:{labels:{djiGeoZones:"Dji Geo Zones",level:"Level",type:"Type",startTime:"Start Time",endTime:"End Time",timeTips:"Time: 24-hour clock",maxAltitude:"Max. Altitude",address:"Address",tips:"Tips",link:"Link",learnMore:"Learn More",helperZoom:"Zoom in to see the Geo Zones",expand:"Expand",collapse:"Collapse",hideGeozones:"Hide Geo Zones",showHide:"Show/Hide Geo Zones"},levels:[{id:0,name:"Warning Zones",desc:"In these Zones, which may not necessarily appear on the DJI GO map, users will be prompted with a warning message. Example Warning Zone: Class E airspace"},{id:1,name:"Authorization Zones",desc:"In these Zones, which appear blue in the DJI GO map, users will be prompted with a warning and flight is limited by default. Authorization Zones may be unlocked by authorized users using a DJI verified account."},{id:2,name:"Restricted Zones",desc:"In these Zones, which appear red the DJI GO app, users will be prompted with a warning and flight is prevented. If you believe you have the authorization to operate in a Restricted Zone, please contact flysafe@dji.com or Online Unlocking."},{id:3,name:"Enhanced Warning Zones",desc:"In these Zones, you will be prompted by GEO at the time of flight to unlock the zone using the same steps as in an Authorization Zone, but you do not require a verified account or an internet connection at the time of your flight."},{id:4,name:"Regulatory Restricted Zones",desc:"Due to local regulations and policies, flights are prohibited within the scope of some special areas. (Example：Prison)"},{id:5,name:"Recommended Zones",desc:""},{id:6,name:"Altitude Zones",desc:"Altitude zones will appear in gray on the map. Users receive warnings in DJI GO, or DJI GO 4 and flight altitude is limited."},{id:7,name:"Recommended Zones",desc:"This area is shown in green on the map. It is recommended that you choose these areas for flight arrangements."},{id:8,name:"Approved Zones for Light UAVs(China)",desc:"For Approved Zones, pilots of light UAVs flying at an altitude of 120 m or less are not required to obtain permission to fly. Pilots who are planning to fly medium-sized UAVs in Approved Zones at an altitude higher than 120 m, or in GEO Zones other than Approved Zones, must obtain permission via UTMISS before taking off"},{id:9,name:"Densely Populated Area",desc:"This area is shown in red on the map. Under normal circumstances, the population of this area is more concentrated, so please do not fly over this area. (Example: Commercial Block)"}],types:[{id:0,name:"Airport"},{id:1,name:"Special Zone"},{id:2,name:"Military Zone"},{id:4,name:"Recommended Zones"},{id:10,name:"Airport"},{id:13,name:"Recreational airport"},{id:14,name:"Recreational airport"},{id:15,name:"Class B Airspace"},{id:16,name:"Class C Airspace"},{id:17,name:"Class D Airspace"},{id:18,name:"Class E Airspace"},{id:19,name:"Heliport"},{id:23,name:"Power plant"},{id:24,name:"Prison"},{id:26,name:"Stadium"},{id:27,name:"Prohibited Airspace"},{id:28,name:"Restricted Airspace"},{id:29,name:"Temporary Flight Restriction"},{id:30,name:"Nuclear Power Plant"},{id:31,name:"Unpaved Airports"},{id:32,name:"Special Zones"},{id:33,name:"Military Zones"},{id:34,name:"Heliport"},{id:35,name:"Seaplane Base"},{id:36,name:"Temporary Flight Restriction"},{id:39,name:"Approved Zones for Light UAVs"},{id:41,name:"Regulatory Restricted Zones for Light UAVs"}]},es:{labels:{djiGeoZones:"Zonas Geo DJI",level:"Nivel",type:"Tipo",startTime:"Horario de apertura",endTime:"Horario de cierre",timeTips:"Sistema horario: 24 horas",maxAltitude:"Altitud máxima",address:"Dirección",tips:"Consejos",link:"Enlace",learnMore:"Leer más",helperZoom:"Acerque la vista para ver las Zonas Geo",expand:"Expandir",collapse:"Colapsar",hideGeozones:"Ocultar Zonas Geo",showHide:"Mostrar/Ocultar Zonas Geo"},levels:[{id:0,name:"Zonas de advertencia",desc:"En estas Zonas, que pueden no aparecer necesariamente en el mapa DJI GO, los usuarios recibirán un mensaje de advertencia. Ejemplo de zona de advertencia: espacio aéreo de clase E"},{id:1,name:"Zonas de autorización",desc:"En estas Zonas, que aparecen en azul en el mapa DJI GO, los usuarios recibirán una advertencia y el vuelo está limitado por defecto. Las zonas de autorización pueden ser desbloqueadas por usuarios autorizados mediante una cuenta verificada por DJI."},{id:2,name:"Zonas restringidas",desc:"En estas Zonas, que aparecen en rojo en la aplicación DJI GO, los usuarios recibirán una advertencia y se impedirá el vuelo. Si cree que tiene la autorización para operar en una Zona restringida, comuníquese con flysafe@dji.com o Desbloqueo en línea."},{id:3,name:"Zonas de advertencia ampliadas",desc:"En estas Zonas, GEO le pedirá en el momento del vuelo que desbloquee la zona siguiendo los mismos pasos que en una Zona de autorización, pero no necesita una cuenta verificada o una conexión a Internet en el momento de su vuelo."},{id:4,name:"Zonas reglamentarias restringidas",desc:"Debido a las regulaciones y políticas locales, los vuelos están prohibidos dentro del alcance de algunas áreas especiales. (Ejemplo: prisión)"},{id:5,name:"Zonas recomendadas",desc:""},{id:6,name:"Zonas de altiutud",desc:"Las zonas de altitud aparecerán en gris en el mapa. Los usuarios reciben advertencias en DJI GO o DJI GO 4 y la altitud de vuelo es limitada."},{id:7,name:"Zonas recomendadas",desc:"Esta área se muestra en verde en el mapa. Se recomienda que elija estas áreas para los arreglos de vuelo."},{id:8,name:"Zonas aprobadas para VANTs livianos (China)",desc:"Para las zonas aprobadas, los pilotos de vehículos aéreos no tripulados ligeros que vuelan a una altitud de 120 mo menos no están obligados a obtener permiso para volar. Los pilotos que planean volar UAV de tamaño mediano en Zonas Aprobadas a una altitud superior a 120 m, o en Zonas GEO distintas de las Zonas Aprobadas, deben obtener permiso a través de UTMISS antes de despegar."},{id:9,name:"Áreas densamente pobladas",desc:"Esta área se muestra en rojo en el mapa. En circunstancias normales, la población de esta zona está más concentrada, así que no sobrevuele esta zona. (Ejemplo: bloque comercial)"}],types:[{id:0,name:"Aeropuerto"},{id:1,name:"Zona especial"},{id:2,name:"Zona Militar"},{id:4,name:"Zona recomendada"},{id:10,name:"Aeropuerto"},{id:13,name:"Aeropuerto recreacional"},{id:14,name:"Aeropuerto recreacional"},{id:15,name:"Espacio aéreo clase B"},{id:16,name:"Espacio aéreo clase C"},{id:17,name:"Espacio aéreo clase D"},{id:18,name:"Espacio aéreo clase E"},{id:19,name:"Helipuerto"},{id:23,name:"Planta de energía"},{id:24,name:"Prisión"},{id:26,name:"Estadio"},{id:27,name:"Espacio aéreo prohibido"},{id:28,name:"Espacio aéreo restringido"},{id:29,name:"Restricción de vuelo temporal"},{id:30,name:"Planta de energía nuclear"},{id:31,name:"Aeropuertos sin pavimentar"},{id:32,name:"Zonas especiales"},{id:33,name:"Zonas militares"},{id:34,name:"Helipuerto"},{id:35,name:"Base de hidroaviones"},{id:36,name:"Restricción de vuelo temporal"},{id:39,name:"Zonas aprobadas para VANTs livianos"},{id:41,name:"Zonas reglamentarias restringidas para VANTs livianos"}]}}),w="data:image/svg+xml,%3csvg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 280.18 280.18'%3e%3cdefs%3e%3cstyle%3e.cls-1%7bfill:%23ffce00%3bfill-opacity:0.68%3bstroke:%23ffce00%3b%7d.cls-1%2c.cls-3%2c.cls-5%2c.cls-6%7bstroke-miterlimit:10%3bstroke-width:0.75px%3b%7d.cls-2%7bfill:%23ff7900%3bfill-opacity:0.46%3b%7d.cls-3%7bfill:%231072d6%3bfill-opacity:0.57%3bstroke:%231072d6%3b%7d.cls-4%7bopacity:0.63%3b%7d.cls-5%7bfill:%23bcbcbc%3bstroke:%23666%3b%7d.cls-6%7bfill:%23fc3424%3bfill-opacity:0.4%3bstroke:%23fc3424%3b%7d%3c/style%3e%3c/defs%3e%3cpath class='cls-1' d='M109.79%2c109.23c-44.68%2c44.68-40.36%2c121.45%2c9.66%2c171.47S246.24%2c335%2c290.92%2c290.36s40.36-121.46-9.65-171.48S154.48%2c64.54%2c109.79%2c109.23ZM270.56%2c270c-34.64%2c34.64-94.15%2c31.29-132.92-7.48s-42.12-98.28-7.48-132.92%2c94.14-31.29%2c132.92%2c7.48S305.2%2c235.36%2c270.56%2c270Z' transform='translate(-59.88 -59.29)'/%3e%3cpath class='cls-2' d='M130.16%2c129.59c-34.64%2c34.64-31.29%2c94.15%2c7.48%2c132.92s98.28%2c42.12%2c132.92%2c7.48%2c31.29-94.14-7.48-132.92S164.79%2c95%2c130.16%2c129.59Zm118%2c118c-24%2c24-64.91%2c22.14-91.29-4.23S128.56%2c176.07%2c152.6%2c152s64.91-22.14%2c91.28%2c4.24S272.15%2c223.51%2c248.12%2c247.55Z' transform='translate(-59.88 -59.29)'/%3e%3cellipse class='cls-3' cx='200.36' cy='199.79' rx='61.55' ry='67.54' transform='translate(-142.47 140.9) rotate(-45)'/%3e%3cg id='Layer_3' data-name='Layer 3'%3e%3cg class='cls-4'%3e%3cpolygon class='cls-5' points='166.25 180 236.66 279.6 236.75 279.51 279.51 236.75 279.6 236.66 180 166.25 166.25 180'/%3e%3cpolygon class='cls-5' points='113.92 100.18 43.51 0.58 43.43 0.67 0.67 43.43 0.58 43.51 100.18 113.92 113.92 100.18'/%3e%3c/g%3e%3cpolygon class='cls-6' points='180 113.92 166.25 100.18 140.09 126.34 113.92 100.18 100.18 113.92 126.34 140.09 100.18 166.25 113.92 180 140.09 153.84 166.25 180 180 166.25 153.84 140.09 180 113.92'/%3e%3c/g%3e%3cg id='Layer_3_copy' data-name='Layer 3 copy'%3e%3cg class='cls-4'%3e%3cpolygon class='cls-5' points='100.18 166.25 0.58 236.66 0.67 236.75 43.43 279.51 43.51 279.6 113.92 180 100.18 166.25'/%3e%3cpolygon class='cls-5' points='180 113.92 279.6 43.51 279.51 43.43 236.75 0.67 236.66 0.58 166.25 100.18 180 113.92'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e";const z=[0,1,2,3,4,5,6,7,8,9],E="ol-dji-geozones--ctrl-toggle-hidden",L=document.createElement("div");class C extends g{constructor(e){super({target:e.target,element:L}),this._featuresIdList=new Set,this._onError=e=>{this.hide(),e.message&&console.error(e)},this._options=Object.assign({urlProxy:"",encodeURIRequest:!0,buffer:1e4,drone:"spark",zonesMode:"total",country:"US",showGeozoneIcons:!0,displayLevels:[2,6,1,0,3,4,7],activeLevels:[2,6,1,0,3,4,7],createPanel:"full",target:null,startCollapsed:!1,startActive:!0,dronesToDisplay:_,extent:null,loadingElement:'<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>',clickEvent:"singleclick",language:"en",alert:null},e||{}),this._i18n=j[this._options.language in j?this._options.language:"en"],this._i18n=Z(this._i18n,e.i18n||{}),this._paramsLevels=b,this._useApiForPopUp=!1,this._hideGeozones=!0,this._isVisible=!1,this._layers=[],this.divControl=null,this._areaDownloaded=null,this.on("error",this._onError)}setMap(e){super.setMap(e),e?(this._options.createPanel&&this._createPanel(this._options.createPanel,this._options.startCollapsed),this._options.startActive&&this.show()):super.getMap()&&(L.remove(),this.destroy())}_initialize(){this._map=super.getMap(),this._view=this._map.getView(),this._projection=this._view.getProjection();(()=>{const o=e=>{const s=e.getGeometry(),o=e.get("level"),t=this._getLevelParamsById(o);let i;if(s instanceof n||s instanceof d){const s=e.get("color");i=new p({fill:new h({color:C.colorWithAlpha(s,.3)}),stroke:new m({color:s,width:1}),zIndex:t.zIndex})}else s instanceof r&&(i=new p({image:new u({src:t.markerIcon,scale:.35,anchor:[.5,.9],crossOrigin:"anonymous"}),zIndex:2*t.zIndex}));return i};z.forEach((t=>{const i=new s({attributions:'<a href="https://www.dji.com/flysafe/geo-map" rel="nofollow noopener noreferrer" target="_blank">DJI GeoZoneMap</a>'}),a={source:i,name:"ol-dji-geozones",level:t,zIndex:2*this._getLevelParamsById(t).zIndex,visible:!this._hideGeozones&&!!this.activeLevels.includes(t),style:o};this._options.extent&&(a.extent=this._options.extent);const n=new e(a);i.on("removefeature",(({feature:e})=>{const s=e.getId()||e.get("areaId");this._featuresIdList.delete(String(s))})),this._map.addLayer(n),this._layers.push(n)}))})(),(()=>{const e=document.createElement("div");e.id="ol-dji-geozones--popup",e.className=`ol-dji-geozones--ol-popup ol-dji-geozones--${this._options.theme}`,this.popupContent=document.createElement("div"),this.popupContent.id="ol-dji-geozones--popup-content",this.popupContent.className="ol-dji-geozones--ol-popup-content";const s=document.createElement("a");s.id="ol-dji-geozones--popup-closer",s.className="ol-dji-geozones--ol-popup-closer",s.href="#",s.onclick=()=>(this._overlay.setPosition(void 0),s.blur(),!1),e.append(s),e.append(this.popupContent),this._overlay=new t({element:e,autoPan:{animation:{duration:250}}}),this._map.addOverlay(this._overlay)})(),this._initialized=!0,super.dispatchEvent("init")}_createPanel(e,s){const o=()=>{this.divControl.classList.add("ol-dji-geozones--ctrl-full"),this.divControl.innerHTML=`\n            <header>\n                <h3>${this._i18n.labels.djiGeoZones}</h3>\n                <span class="ol-dji-geozones--loading">\n                    ${this._options.loadingElement}\n                </span>\n            </header>\n            <main>\n                <section class="ol-dji-geozones--selectors"></section>\n                <section>\n                    <div class="ol-dji-geozones--logo" title="${this._i18n.labels.expand}"><img src="${w}"/></div>\n                    <span class="ol-dji-geozones--advice">${this._i18n.labels.helperZoom}</span>\n                </section>\n            </main>\n            `;const e=(()=>{const e=document.createElement("div");e.className="ol-dji-geozones--drone-selector";const s=document.createElement("select");s.onchange=({target:e})=>{this.drone=e.value||e.options[e.selectedIndex].value,this._getInfoFromView(!0)},this._isVisible||s.setAttribute("disabled","disabled");let o="";return this.dronesToDisplay.forEach((e=>{const s=this.drone===e.id?"selected":"";o+=`<option value="${e.id}" ${s}>${e.label}</option>`})),s.innerHTML=o,e.append(s),e})();this.divControl.querySelector(".ol-dji-geozones--selectors").append(e);const s=(()=>{const e=({target:e})=>{const s=Number(e.value);e.checked?this.addLevels(s):this.removeLevels(s)},s=(e,s,o)=>{const t=document.createElement("label");return t.htmlFor=s,t.append((e=>{const s=document.createElement("span");return s.className="ol-dji-geozones--mark",s.style.border=`1px ${e} solid`,s.style.backgroundColor=C.colorWithAlpha(e,.4),s})(o)),t.append(e),t},o=(s,o,t)=>{const i=document.createElement("input");return i.type="checkbox",i.name=s,i.id=s,i.value=String(o),i.onclick=e,-1!==this.activeLevels.indexOf(o)&&(i.checked=!0),t&&(i.disabled=!0),i},t=(e,{name:t,desc:i,color:a})=>{const n=!this._isVisible,l="level"+e,r=document.createElement("div");return r.className=`ol-dji-geozones--item-ctl ol-dji-geozones--item-ctl-${e}`,r.title=i,r.setAttribute("data-level",String(e)),r.append(o(l,e,n)),r.append(s(t,l,a)),r},i=document.createElement("div");return i.className="ol-dji-geozones--level-selector",this._options.displayLevels.forEach((e=>{const s=t(e,this.getLevelById(e));i.append(s)})),i})();this.divControl.querySelector(".ol-dji-geozones--selectors").append(s);const o=(()=>{const e=document.createElement("button");return e.className="ol-dji-geozones--collapse ol-dji-geozones--btn-sm",e.title=this._i18n.labels.collapse,e.onclick=()=>this.setPanelCollapsed(!0),e})();this.divControl.querySelector("header").append(o);const t=(()=>{const e=document.createElement("button");return e.className="ol-dji-geozones--visibility ol-dji-geozones--btn-sm",e.title=this._i18n.labels.hideGeozones,e.innerHTML="<img src=\"data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='768' height='768' viewBox='0 0 768 768'%3e%3cpath d='M384 288q39 0 67.5 28.5t28.5 67.5-28.5 67.5-67.5 28.5-67.5-28.5-28.5-67.5 28.5-67.5 67.5-28.5zM384 544.5q66 0 113.25-47.25t47.25-113.25-47.25-113.25-113.25-47.25-113.25 47.25-47.25 113.25 47.25 113.25 113.25 47.25zM384 144q118.5 0 214.5 66t138 174q-42 108-138 174t-214.5 66-214.5-66-138-174q42-108 138-174t214.5-66z'%3e%3c/path%3e%3c/svg%3e\"/>",e.onclick=()=>{this.hide()},e})();this.divControl.querySelector("header").append(t);this.divControl.querySelector(".ol-dji-geozones--logo").onclick=()=>{this.divControl.classList.contains(E)&&this.show(),this.setPanelCollapsed(!1)}},t=()=>{this.divControl.classList.add("ol-dji-geozones--ctrl-compact"),this.divControl.innerHTML=`\n            <header>\n                <span class="ol-dji-geozones--loading">\n                    ${this._options.loadingElement}\n                </span>\n            </header>\n            <main>\n                <section>\n                    <div class="ol-dji-geozones--logo" title="${this._i18n.labels.showHide}"><img src="${w}"/></div>\n                </section>\n            </main>\n            `;this.divControl.querySelector(".ol-dji-geozones--logo").onclick=()=>{this.divControl.classList.contains("ol-dji-geozones--ctrl-toggle-hidden")?this.show():this.hide()}};if(this.divControl=L,this.divControl.className=`ol-dji-geozones ol-control ol-dji-geozones--${this._options.theme}`,this._hideGeozones?this.divControl.classList.add("ol-dji-geozones--ctrl-toggle-hidden"):this._isVisible||this.divControl.classList.add("ol-dji-geozones--ctrl-disabled"),s&&this.divControl.classList.add("ol-dji-geozones--ctrl-collapsed"),!0===e||"full"===e)o();else{if("compact"!==e)return;t()}}_setLayersVisible(e){this.layers.forEach((s=>{e?e&&this.activeLevels.includes(s.get("level"))&&s.setVisible(e):s.setVisible(e)}))}_setControlEnabled(e){if(!this.divControl)return;const s=s=>{s.forEach((s=>{e?s.removeAttribute("disabled"):s.disabled=!0}))};e?this.divControl.classList.remove("ol-dji-geozones--ctrl-disabled"):this.divControl.classList.add("ol-dji-geozones--ctrl-disabled");s(this.divControl.querySelectorAll("input"));s(this.divControl.querySelectorAll("select"))}async _getPointInfoFromClick(e,s){const o=["name","level","type","height","shape","start_at","end_at","url","address","description"];let t=0;const a=async e=>{t+=1;const s=t;return new Promise((o=>{setTimeout((async()=>{if(s!==t)return;const a=i.transform(e,this._projection,"EPSG:4326"),n={lat:a[1],lng:a[0]},l=(await this._getApiGeoData("info",n)).areas;l.length||o(!1);const r=[];for(const e of l)r.push(e);o(r)}),100)}))},n=(e,s)=>{const o=e=>{let s;const o=()=>{i.style.position="fixed";const e=a.getBoundingClientRect();i.style.top=e.top+"px",i.style.left=e.left+"px",i.classList.add("ol-dji-geozones--active-tooltip"),s=this._map.once("movestart",(()=>t())),document.body.append(i)},t=()=>{i.classList.remove("ol-dji-geozones--active-tooltip"),y.unByKey(s),n.append(i)},i=document.createElement("span");i.className=`ol-dji-geozones--info ol-dji-geozones--${this._options.theme}`,i.innerHTML=`<span class="ol-dji-geozones--info-text">${e.desc}</span><span class="ol-dji-geozones--info-back"></span>`,i.setAttribute("style",`--level-color: ${e.color}`);const a=document.createElement("span");a.className="ol-dji-geozones--icon",a.innerHTML="<img src=\"data:image/svg+xml,%3csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='768' height='768' viewBox='0 0 768 768'%3e%3ctitle%3e%3c/title%3e%3cpath d='M352.5 288v-64.5h63v64.5h-63zM384 640.5q105 0 180.75-75.75t75.75-180.75-75.75-180.75-180.75-75.75-180.75 75.75-75.75 180.75 75.75 180.75 180.75 75.75zM384 64.5q132 0 225.75 93.75t93.75 225.75-93.75 225.75-225.75 93.75-225.75-93.75-93.75-225.75 93.75-225.75 225.75-93.75zM352.5 544.5v-192h63v192h-63z'%3e%3c/path%3e%3c/svg%3e\">",a.onmouseover=()=>o(),a.onclick=()=>o(),a.onmouseout=()=>t();const n=document.createElement("div");return n.className="ol-dji-geozones--tooltip",n.append(a),n.append(i),n},t=e=>{var s;const{name:t,level:i,type:a,height:n,description:l,begin_at:r,end_at:d,address:c,url:p}=e,h=this.getLevelById(i),m=this._i18n.labels,u=null===(s=this._getGeozoneTypeById(a))||void 0===s?void 0:s.name,g=`\n                    <div class="ol-dji-geozones--marker">\n                        <img src="${h.markerCircle}">\n                    </div>\n                    <div class="ol-dji-geozones--main">\n                        <h3 class="ol-dji-geozones--title">${t}</h3>\n                        <p class="ol-dji-geozones--level">${m.level}: ${h.name} </p>\n                    ${u?`<p class="ol-dji-geozones--type">\n                        ${m.type}: ${u}\n                    </p>`:""}                     \n                        ${r?`<p class="ol-dji-geozones--start_time">${m.startTime}: ${r}</p>`:""}\n                        ${d?`<p class="ol-dji-geozones--end_time">${m.endTime}: ${d}</p><p class="ol-dji-geozones--time_tips">${m.timeTips}</p>`:""}         \n                        ${n?`<p class="ol-dji-geozones--height">${m.maxAltitude} (m): ${n}</p>`:""} \n                        ${c?`<p class="ol-dji-geozones--address">${m.address}: ${c}</p>`:""}\n                        ${l?`<p class="ol-dji-geozones--desc">${m.tips}: ${l}</p>`:""}\n                        ${p?`<p class="ol-dji-geozones--url">${m.link}: <a href="${p}">${m.learnMore}</a></p>`:""}\n                </div>`,v=document.createElement("div");return v.className="ol-dji-geozones--item",v.innerHTML=g,v.querySelector(".ol-dji-geozones--level").append(o(h)),v},i=[],a=Array.isArray(e)?e:[e];this.popupContent.innerHTML="",a.forEach((e=>{const s=t(e);-1===i.indexOf(s.innerHTML)&&(i.push(s.innerHTML),this.popupContent.append(s),this.popupContent.append(document.createElement("HR")))})),this._overlay.setPosition(s)};try{if(!this._isVisible)return void this._overlay.setPosition(void 0);const t={layerFilter:e=>"ol-dji-geozones"===e.get("name")};let i;if("useApiForPopUp"===s)this._map.hasFeatureAtPixel(e.pixel,t)&&(this.popupContent.innerHTML=this._options.loadingElement.toString(),this._overlay.setPosition(e.coordinate),i=await a(e.coordinate));else{const s=this._map.getFeaturesAtPixel(e.pixel,t);s&&s.length&&(i=(e=>{const s=[];return e.forEach((e=>{const t={};o.forEach((s=>t[s]=e.get(s))),s.push(t)})),s})(s))}i&&i.length?n(i,e.coordinate):this._overlay.setPosition(void 0)}catch(e){console.log(e)}}_getInfoFromView(e=!1){let s=0;const t=e=>{const s=e.get("color"),o=Object.keys(this._paramsLevels).find((e=>this._paramsLevels[e].color===s));return e.set("level",o,!0),e},a=e=>{const s=e.areas;if(!s||!s.length)return!1;const i=[];for(const e of s){if(this._featuresIdList.has(String(e.area_id)))continue;const s={address:e.address,begin_at:e.begin_at,color:e.color,city:e.city,country:e.country,data_source:e.data_source,description:e.description,end_at:e.end_at,height:e.height,level:e.level,name:e.name,radius:e.radius,shape:e.shape,type:e.type,url:e.url,lng:e.lng,lat:e.lat};if(e.polygon_points){const a=new o(Object.assign(Object.assign({},s),{geometry:new n(e.polygon_points).transform("EPSG:4326",this._projection)}));a.setId(e.area_id+"_poly"),i.push(t(a))}if(this._featuresIdList.add(String(e.area_id)),this._options.showGeozoneIcons){const a=new o(Object.assign(Object.assign({},s),{geometry:new r([e.lng,e.lat]).transform("EPSG:4326",this._projection)}));a.setId(e.area_id),i.push(t(a))}e.sub_areas&&e.sub_areas.forEach((s=>{let a;a=s.polygon_points?new o({color:s.color,height:s.height,level:s.level,name:e.name,radius:s.radius,shape:s.shape,type:e.type,lng:s.lng,lat:s.lat,geometry:new n(s.polygon_points).transform("EPSG:4326",this._projection)}):new o({color:s.color,height:s.height,level:s.level,name:e.name,radius:s.radius,shape:s.shape,type:e.type,lng:s.lng,lat:s.lat,geometry:new d([s.lng,s.lat],s.radius/1e5).transform("EPSG:4326",this._projection)}),a.set("areaId",e.area_id),i.push(t(a))}))}return i},l=e=>{e&&e.forEach((e=>{const s=e.get("level");this.getLayerByLevel(s).getSource().addFeature(e)}))},c=()=>{this.layers.forEach((e=>{e.getSource().clear()}))};s+=1;setTimeout((async()=>{try{this._showLoading(!0);const s=this._view.getCenter(),o=i.transform(s,this._projection,"EPSG:4326"),t={lat:o[1],lng:o[0]};e&&(this._areaDownloaded=null);const n=await this._getApiGeoData("areas",t);if(n){e&&c();const s=a(n);s&&l(s)}}catch(e){this.dispatchEvent(new I(e))}this._showLoading(!1)}),300)}async _getApiGeoData(e,s){const o=async(e,{lng:s,lat:o},t)=>{let i=("areas"===e?"https://www-api.dji.com/api/geo/areas":"https://www-api.dji.com/api/geo/point-info")+"?";const a={drone:this.drone,zones_mode:this.zonesMode,country:this.country,level:z,lng:s,lat:o,search_radius:t};Object.keys(a).forEach((e=>i+=`${e}=${a[e]}&`));const n=!1===this._options.encodeURIRequest?i:encodeURIComponent(i),l=this._options.urlProxy?this._options.urlProxy+n:n,r=await fetch(l);if(!r.ok)throw new Error("HTTP-Error: "+r.status);return await r.json()},t=async(e,s)=>{let t=this._view.calculateExtent();this._options.buffer&&(t=i.transform(t,this._projection,"EPSG:3857"),t=this._options.buffer?f.buffer(t,this._options.buffer):t,t=i.transform(t,"EPSG:3857",this._projection));const a=n.fromExtent(t);if(this._areaDownloaded){if(this._areaDownloaded.intersectsCoordinate(f.getCenter(t))&&this._areaDownloaded.intersectsCoordinate(f.getBottomLeft(t))&&this._areaDownloaded.intersectsCoordinate(f.getTopRight(t))&&this._areaDownloaded.intersectsCoordinate(f.getBottomRight(t))&&this._areaDownloaded.intersectsCoordinate(f.getTopLeft(t)))return;this._areaDownloaded.appendPolygon(a)}else this._areaDownloaded=new l([a.getCoordinates()]);return await o("areas",e,s)};if(!this._isVisible)return;const r=(({lng:e,lat:s})=>{const o=[e,s],t=this._map.getSize();let n=this._view.calculateExtent(t);n=i.transformExtent(n,this._projection,"EPSG:4326");const l=[n[0],n[1]],r=a.getDistance(o,l)+this._options.buffer;return parseInt(String(r))})(s);let d;return d="areas"===e?await t(s,r):await(async(e,s)=>await o("info",e,s))(s,r),d}_showLoading(e){this.divControl&&(e?this.divControl.classList.add("ol-dji-geozones--isLoading"):this.divControl.classList.remove("ol-dji-geozones--isLoading"))}setPanelVisible(e){this.divControl&&(e?this.divControl.classList.remove("ol-dji-geozones--ctrl-hidden"):this.divControl.classList.add("ol-dji-geozones--ctrl-hidden"))}setPanelCollapsed(e){this.divControl&&(e?this.divControl.classList.add("ol-dji-geozones--ctrl-collapsed"):this.divControl.classList.remove("ol-dji-geozones--ctrl-collapsed"))}get layers(){return this._layers}getLayerByLevel(e){let s;for(const o of this.layers)if(null!=o.get("level")&&o.get("level")==e){s=o;break}return s}_getGeozoneTypeById(e=null){return this._i18n.types.find((s=>s.id==e))}get dronesToDisplay(){return this._options.dronesToDisplay}set drone(e){this._options.drone=e,this._getInfoFromView()}get drone(){return this._options.drone}set zonesMode(e){this._options.zonesMode=e,this._getInfoFromView()}get zonesMode(){return this._options.zonesMode}set country(e){this._options.country=e,this._getInfoFromView()}get country(){return this._options.country}_getLevelParamsById(e=null){return this._paramsLevels.find((s=>s.id==e))}getLevelById(e=null){const s=this._paramsLevels.find((s=>s.id==e)),o=this._i18n.levels.find((s=>s.id==e));return Object.assign(Object.assign({},s),o)}set activeLevels(e){this._options.activeLevels=e,this._options.displayLevels.forEach((s=>{const o=this.getLayerByLevel(s);e.includes(s)?o.setVisible(!0):o.setVisible(!1)}))}get activeLevels(){return this._options.activeLevels}addLevels(e,s=!0){const o=Array.isArray(e)?e:[e];this.activeLevels=[...this.activeLevels,...o],s&&o.forEach((e=>{this.getLayerByLevel(e).setVisible(!0)}))}removeLevels(e,s=!0){const o=Array.isArray(e)?e:[e];this.activeLevels=this.activeLevels.filter((e=>!o.includes(e))),s&&o.forEach((e=>{this.getLayerByLevel(e).setVisible(!1)}))}destroy(){this.layers.forEach((e=>{this._map.removeLayer(e)})),this._map.removeOverlay(this._overlay),this._removeListeners()}hide(){this._hideGeozones=!0,this._setLayersVisible(!1),this._setControlEnabled(!1),this._removeListeners(),this.divControl&&this.divControl.classList.add(E)}show(){this._initialized||this._initialize(),this._listeners||this._addListeners(),this._hideGeozones=!1,this._isVisible=this._view.getZoom()>=9,this._showLoading(!0),this._isVisible?(this._setControlEnabled(!0),this._getInfoFromView(),this._setLayersVisible(!0),this.divControl&&this.divControl.classList.remove(E)):(this._alert(this._i18n.labels.helperZoom),this._showLoading(!1))}_removeListeners(){y.unByKey(this._clickEvtKey),y.unByKey(this._moveendEvtKey),this._listeners=!1}_addListeners(){const e=()=>{if(this._currentZoom<9)this._isVisible&&(this._setLayersVisible(!1),this._isVisible=!1,this._setControlEnabled(!1));else{if(this._isVisible){if(!this._lastZoom||this._currentZoom>this._lastZoom)return}else this._setLayersVisible(!0),this._isVisible=!0,this._setControlEnabled(!0),this.divControl&&this.divControl.classList.remove(E);this._getInfoFromView()}},s=()=>{this._isVisible&&!this._hideGeozones&&this._getInfoFromView()};this._moveendEvtKey=this._map.on("moveend",(()=>{this._currentZoom=this._view.getZoom(),this._currentZoom!==this._lastZoom?e():s(),this._lastZoom=this._currentZoom})),this._clickEvtKey=this._map.on(this._options.clickEvent,(e=>{const s=this._useApiForPopUp?"useApiForPopUp":"useFeaturesForPopUp";this._getPointInfoFromClick(e,s)})),this._listeners=!0}_alert(e){"function"==typeof this._options.alert?this._options.alert(e):alert(e)}static colorWithAlpha(e,s=1){const[o,t,i]=Array.from(v.asArray(e));return v.asString([o,t,i,s])}}class I extends c{constructor(e){super("error"),this.message=e.message,this.stack=e.stack}}const Z=(e,...s)=>(s.forEach((s=>{Object.keys(s).forEach((o=>{const t=s[o],i=e[o];e[o]=i&&t&&"object"==typeof i&&"object"==typeof t&&!Array.isArray(i)?Z(i,t):t}))})),e);return C}));
//# sourceMappingURL=ol-dji-geozones.min.js.map
